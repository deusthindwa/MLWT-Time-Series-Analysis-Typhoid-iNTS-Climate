---
title: Impact of Climate on the Risk of Non-typhoid Salmonellosis and Typhoid Fever
  in Blantyre, Malawi; A Distributed Lag Non-linear Modelling Study.
author: "By Deus Thindwa"
date: "08/02/2019"
output:
  html_document: default
  pdf_document: default
  word_document: default
---

<style type="text/css">
.main-container {
  max-width: 1300px;
  margin-left: auto;
  margin-right: auto;
}
</style>

##### Load required packages for entire analysis
```{r LoadPackages, results='hide', message=FALSE, warning=FALSE}
dlnm.pkg <- c("tidyverse", "lubridate","xts","ggthemes","PerformanceAnalytics","reshape2","rugarch","timetk","parallel","timeSeries","tseries","data.table","ggplot2","dlnm","broom","caret","gridExtra","splines","splines2","pspline","cowplot","mgcv","spi","chron","gridGraphics","grid","pscl","MASS", "AER", "Hmisc", "MuMIn", "VGAM", "forecast", "seasonal", "plotly", "ggmap", "rgeos", "tmap", "maptools", "maps", "ggfortify", "htmltools","webshot","knitr","flexdashboard", "imager", "httr", "curl", "here")

lapply(dlnm.pkg, library, character.only=TRUE)
``` 

##### Load Malawi map dataset
```{r LoadMWMap, results="hide"}
dlnmtmp <- tempfile()
download.file("https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/malawi_map.zip", destfile=dlnmtmp)
unzip(dlnmtmp, exdir = ".")
malawi.map <- rgdal::readOGR(".","malawi_map")
```

##### Subset Blantyre map from Malawi map
```{r CropBTMap, results="hide"}
blantyre1.map <- malawi.map@data$OBJECTID >289 & malawi.map@data$OBJECTID <297 
blantyre2.map <- malawi.map@data$OBJECTID >308 & malawi.map@data$OBJECTID <311
blantyre3.map <- malawi.map@data$OBJECTID >342
```

##### Convert shape files into dataframe
```{r SFtoDF, results="hide", message=FALSE, warning=FALSE}
blantyre.map <- rbind(fortify(malawi.map[blantyre1.map,]), fortify(malawi.map[blantyre2.map,]), fortify(malawi.map[blantyre3.map,]))
blantyre.map$id <- as.integer(blantyre.map$id)
```

##### Load Blantyre demographics' and features' dataset
```{r LoadDemoDS, results="hide", message=FALSE, warning=FALSE}
blantyre.demog <- read.csv(curl("https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/blantyre_demog.csv"))
	map.features <- read.csv(curl("https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/blantyre_features.csv"))
	blantyre.demog$id <- as.integer(blantyre.demog$id)
	map.all <- merge(x=blantyre.map, y=blantyre.demog, by="id", x.all=TRUE)
	rm(list = ls()[grep("^blantyre", ls())])
```

##### Plot the map of Blantyre (Figure 1)
```{r PlotBTMap, message=FALSE, warning=FALSE, fig.width=8, fig.height = 5, fig.align='center'}
ggplot() + 
geom_polygon(data=map.all,aes(x=long,y=lat,group=group,fill=popc),colour="gray50") + 
theme_classic() + 
theme(axis.text.x=element_text(face="bold", size=10, color="black"), axis.text.y=element_text(face="bold", size=10, color="black")) + 
labs(fill="(1998 - 2008) Population censuses") + 
xlab("Longitude") + 
ylab("Latitude") + 
geom_point(data=map.features, aes(x=long, y=lat, shape=Geolocation, size=Geolocation), color="black") +
scale_shape_manual(values=c(17, 16, 3)) +
scale_size_manual(values=c(2,4,3)) + 
theme(legend.key.height=unit(0.8, "line")) + 
theme(legend.key.width=unit(0.8, "line"))
```

##### Load case dataset and subset by serovar
```{r LoadCaseDS, results="hide", message=FALSE, warning=FALSE}
case <-read.csv(curl("https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/case.csv"))
case$case_date <- dmy(case$case_date)
case$case_count <- c(1)
case.typhi <- subset(case, organism=="typhi")
case.iNTS <- subset(case, organism=="iNTS")
```

##### Assign 0 when no case was diagnosed on that day
```{r AssignCaseDS, results="hide", message=FALSE, warning=FALSE}
case.typhi <-aggregate(case.typhi$case_count, by=list(case.typhi$case_date), FUN=sum, na.rm=TRUE)
names(case.typhi) <- c("date", "case_count")
case.typhi <- merge(case.typhi, data.table(date=seq.Date(min(case$case_date), max(case$case_date), by="day")), by="date", all=TRUE)
case.typhi[is.na(case.typhi)]<-0

case.iNTS <-aggregate(case.iNTS$case_count, by=list(case.iNTS$case_date), FUN=sum, na.rm=TRUE)
names(case.iNTS) <- c("date", "case_count")
case.iNTS <- merge(case.iNTS, data.table(date=seq.Date(min(case$case_date), max(case$case_date), by="day")), by="date", all=TRUE)
case.iNTS[is.na(case.iNTS)]<-0
```

##### Convert to XTS and aggregate monthly
```{r ConvertCaseTXS, results="hide", message=FALSE, warning=FALSE}
case.typhi = as.xts(case.typhi[,-1,drop=FALSE], order.by=as.Date(case.typhi[,1]))
case.iNTS = as.xts(case.iNTS[,-1,drop=FALSE], order.by=as.Date(case.iNTS[,1]))
case.typhi <- apply.monthly(case.typhi, FUN=sum)
case.iNTS <- apply.monthly(case.iNTS, FUN=sum)
```

##### Load Blantyre climate dataset
```{r LoadClimateDS, results="hide", message=FALSE, warning=FALSE}
climate <- read.csv(curl("https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/climate.csv"))
```

##### Define average rain/temp between chileka & chichiri stations
```{r DefineRT, results="hide", message=FALSE, warning=FALSE}
climate$climate_date <- dmy(climate$date)
climate$rainfall <- (climate$chil_r+climate$chic_r)/2 
climate$temperature <- ((climate$chil_mint+climate$chil_maxt)/2+(climate$chic_mint+climate$chic_maxt)/2)/2
climate <- subset(climate, select=c(climate_date, rainfall, temperature))
climate.rain <- subset(climate, select=c(climate_date, rainfall))
climate.temp <- subset(climate, select=c(climate_date, temperature))
```

##### Convert to XTS and aggregate monthly
```{r ConvertClimateTXS, results="hide", message=FALSE, warning=FALSE}
climate.rain <- as.xts(climate.rain[,-1, drop=FALSE], order.by=as.Date(climate.rain[,1]))
climate.temp <- as.xts(climate.temp[,-1, drop=FALSE], order.by=as.Date(climate.temp[,1]))
climate.rain <- apply.monthly(climate.rain, FUN=mean)
climate.temp <- apply.monthly(climate.temp, FUN=mean)
```

##### Create datasets for time series decomposition
```{r CreateTibbles, results="hide", message=FALSE, warning=FALSE}
case.typhi <- tk_tbl(case.typhi, preserve_index=TRUE, rename_index="date") 
case.iNTS <- tk_tbl(case.iNTS, preserve_index=TRUE, rename_index="date") 
climate.rain <- tk_tbl(climate.rain, preserve_index=TRUE, rename_index="date") 
climate.temp <- tk_tbl(climate.temp, preserve_index=TRUE, rename_index="date") 
```

##### Seasonal-adjusted NTS cases
```{r SeasonalAdjNTS, results="hide", message=FALSE, warning=FALSE}
case.iNTS.ts <- ts(na.omit(case.iNTS$case_count), frequency=12)
trend_n <- tk_tbl(exp(seasadj(mstl(log(case.iNTS.ts)))), preserve_index=FALSE)
case.iNTS$case_count_sea <- trend_n$value 
case.iNTS$case_count_sea[case.iNTS$case_count_sea < 0] <- 0
setnames(case.iNTS, old="case_count", new="case_count_obs")
trend_n <-tk_tbl(exp(mstl(log(case.iNTS.ts))))
case.iNTS$case_count_tre <- trend_n$Trend
```

##### Seasonal-adjusted typhoid cases
```{r SeasonalAdjTYP, results="hide", message=FALSE, warning=FALSE}
case.typhi.ts <- ts(na.omit(case.typhi$case_count), frequency=12)
trend_n <- tk_tbl(exp(seasadj(mstl(log(case.typhi.ts+1)))), preserve_index=FALSE)
case.typhi$case_count_sea <-trend_n$value
case.typhi$case_count_sea[case.typhi$case_count_sea < 0] <- 0
setnames(case.typhi, old="case_count", new="case_count_obs")
trend_n <- tk_tbl(exp(mstl(log(case.typhi.ts+1))))
case.typhi$case_count_tre <- trend_n$Trend
```

##### Seasonal-adjusted rainfall
```{r SeasonalAdjRain, results="hide", message=FALSE, warning=FALSE}
climate.rain.ts <- ts(na.omit(climate.rain$rainfall), frequency=12)
trend_n <- tk_tbl(seasadj(mstl(climate.rain.ts)), preserve_index=FALSE)
climate.rain$rainfall_sea <- trend_n$value
climate.rain$rainfall_sea[climate.rain$rainfall_sea < 0] <- 0
setnames(climate.rain, old="rainfall", new="rainfall_obs")
trend_n <-tk_tbl(mstl(climate.rain.ts))
climate.rain$rain_tre <- trend_n$Trend
```

##### Seasonal-adjusted temperature
```{r SeasonalAdjTemp, results="hide", message=FALSE, warning=FALSE}
climate.temp.ts <- ts(na.omit(climate.temp$temperature), frequency=12)
trend_n <-tk_tbl(seasadj(mstl(climate.temp.ts)), preserve_index=FALSE)
climate.temp$temperature_sea <- trend_n$value
climate.temp$temperature_sea[climate.temp$temperature_sea < 0] <- 0
setnames(climate.temp, old="temperature", new="temperature_obs")
trend_n <- tk_tbl(mstl(climate.temp.ts))
climate.temp$temp_tre <- trend_n$Trend

rm(list=ls()[grep("^trend_n", ls())])
```

##### Plots of decomposed series (Supplementary Figure 1)
```{r DecomposedTS, results="hide", message=FALSE, warning=FALSE, fig.width=10, fig.height=5, fig.align='center'}
x<-case.iNTS.ts %>% mstl() %>% ggfortify:::autoplot.ts(main="A",xlab="Years (2000-2015)",size=1,colour="orange2",is.date=FALSE)+theme_bw()
y<-case.typhi.ts %>% mstl() %>% ggfortify:::autoplot.ts(main="B",xlab="Years (2000-2015)",size=1,colour="red2",is.date=FALSE)+theme_bw()
z<-climate.rain.ts %>% mstl() %>% ggfortify:::autoplot.ts(main="C",xlab="Years (2000-2015)",size=1,colour="blue2",is.date=FALSE)+theme_bw()
v<-climate.temp.ts %>% mstl() %>% ggfortify:::autoplot.ts(main="D",xlab="Years (2000-2015)",size=1,colour="green2",is.date=FALSE)+theme_bw()
grid.arrange(grobs=list(x,y,z,v), ncol=4, nrow=1)
```

##### Plots of seasonal-adjusted incidences (Supplementary Figure 2)
```{r SeasonAdjTS, results="hide", message=FALSE, warning=FALSE, fig.width=9, fig.height=5, fig.align='center'}
Th <- theme(plot.title=element_text(hjust=0)) + 
theme(axis.title.x=element_text(size=10)) + 
theme(axis.title.y=element_text(size=10)) +
theme(axis.text.x=element_text(face="bold", size=10), axis.text.y=element_text(face="bold", size=10)) + 
theme(legend.key.height=unit(1, "line")) + 
theme(legend.key.width=unit(1, "line")) 

S1 <- ggplot(as.data.frame(case.iNTS)) + 
geom_line(aes(date, case_count_obs, color="Original"), size=0.8) + 
geom_line(aes(date, case_count_sea, color="Seasonal-adjusted"), size=0.8) + 
scale_color_manual(values = c("Original"="black","Seasonal-adjusted"="orange2")) +
labs(title="A", x="", y="NTS cases") + theme(plot.title=element_text(hjust=0)) +
theme(legend.justification=c(0.5,0), legend.position=c(0.7,0.7), legend.text=element_text(size=10), 
legend.title=element_text(size=0))

S2<-ggplot(as.data.frame(case.typhi)) + 
geom_line(aes(date, case_count_obs, color="Original"), size=0.8) + 
geom_line(aes(date, case_count_sea, color="Seasonal-adjusted"), size=0.8) + 
scale_color_manual(values = c("Original"="black","Seasonal-adjusted"="red2")) +
labs(title="B", x ="", y="Typhoid cases") + Th +
theme(legend.justification=c(0.5,0), legend.position = c(0.3,0.7), legend.text = element_text(size = 10), 
legend.title = element_text(size=0))

S3<-ggplot(as.data.frame(climate.rain)) + 
geom_line(aes(date, rainfall_obs, color="Original"), size=0.8) + 
geom_line(aes(date, rainfall_sea, color="Seasonal-adjusted"), size=0.8) + 
scale_color_manual(values = c("Original"="black","Seasonal-adjusted"="blue2")) +
labs(title="C", x ="Year", y = "Rainfall (mm)") + Th + 
theme(legend.justification=c(0.5,0), legend.position = c(0.3,0.7), legend.text = element_text(size = 10), 
legend.title = element_text(size=0))

S4<-ggplot(as.data.frame(climate.temp)) + 
geom_line(aes(date, temperature_obs, color="Original"), size=0.8) + 
geom_line(aes(date, temperature_sea, color="Seasonal-adjusted"), size=0.8) + 
scale_color_manual(values = c("Original"="black","Seasonal-adjusted"="green2")) + 
labs(title="D", x ="Year", y = "Temperature (°C)") + Th + 
theme(legend.justification=c(0.5,0), legend.position = c(0.3,0.7), legend.text = element_text(size = 10), 
legend.title = element_text(size=0))

grid.arrange(grobs=list(S1, S2, S3, S4), ncol=2, nrow=2)
```

##### Inter/extraporate population denominators
```{r InterExtraPoration, results="hide", message=FALSE, warning=FALSE}
census.year <-c(1998, 2008)
census.popn <-c(809397, 1022680)
census.count.1998.2008 <-approx(census.year, census.popn, n=11) 
census.count.2009.2015 <-approxExtrap(census.year, census.popn, xout=c(2009, 2010, 2011, 2012, 2013, 2014, 2015))
```

##### Calculate NTS/typhoid incidence rates
```{r CaseIncidence, results="hide", message=FALSE, warning=FALSE}
case.iNTS$census[year(case.iNTS$date)==2000]<-852054; case.iNTS$census[year(case.iNTS$date)==2001]<-873382
case.iNTS$census[year(case.iNTS$date)==2002]<-894710; case.iNTS$census[year(case.iNTS$date)==2003]<-916039
case.iNTS$census[year(case.iNTS$date)==2004]<-937367; case.iNTS$census[year(case.iNTS$date)==2005]<-958695
case.iNTS$census[year(case.iNTS$date)==2006]<-980023; case.iNTS$census[year(case.iNTS$date)==2007]<-1001352
case.iNTS$census[year(case.iNTS$date)==2008]<-1022680; case.iNTS$census[year(case.iNTS$date)==2009]<-1044008
case.iNTS$census[year(case.iNTS$date)==2010]<-1065337; case.iNTS$census[year(case.iNTS$date)==2011]<-1086665
case.iNTS$census[year(case.iNTS$date)==2012]<-1107993; case.iNTS$census[year(case.iNTS$date)==2013]<-1129322
case.iNTS$census[year(case.iNTS$date)==2014]<-1150650; case.iNTS$census[year(case.iNTS$date)==2015]<-1171978
case.iNTS$incid_sea <-case.iNTS$case_count_sea*100000/case.iNTS$census 
case.iNTS$incid_obs <-case.iNTS$case_count_obs*100000/case.iNTS$census 

case.typhi$census[year(case.typhi$date)==2000]<-852054; case.typhi$census[year(case.typhi$date)==2001]<-873382
case.typhi$census[year(case.typhi$date)==2002]<-894710; case.typhi$census[year(case.typhi$date)==2003]<-916039
case.typhi$census[year(case.typhi$date)==2004]<-937367; case.typhi$census[year(case.typhi$date)==2005]<-958695
case.typhi$census[year(case.typhi$date)==2006]<-980023; case.typhi$census[year(case.typhi$date)==2007]<-1001352
case.typhi$census[year(case.typhi$date)==2008]<-1022680; case.typhi$census[year(case.typhi$date)==2009]<-1044008
case.typhi$census[year(case.typhi$date)==2010]<-1065337; case.typhi$census[year(case.typhi$date)==2011]<-1086665
case.typhi$census[year(case.typhi$date)==2012]<-1107993; case.typhi$census[year(case.typhi$date)==2013]<-1129322
case.typhi$census[year(case.typhi$date)==2014]<-1150650; case.typhi$census[year(case.typhi$date)==2015]<-1171978
case.typhi$incid_sea <-case.typhi$case_count_sea*100000/case.typhi$census 
case.typhi$incid_obs <-case.typhi$case_count_obs*100000/case.typhi$census  
```

##### Plots of trends in NTS, typhoid, rain and temperature (Supplementary Figure 3)
```{r CaseTrends, results="hide", message=FALSE, warning=FALSE, fig.width=10, fig.height=6, fig.align='center'}
E1<-ggplot() + 
geom_line(data=case.iNTS, aes(x=date, y=case_count_tre, color="Number of NTS cases"), stat="identity", size=1.0) + 
geom_line(data=climate.rain, aes(x=date, y=rain_tre/0.04, color="Rainfall"), alpha=0.8, size=0.7) + 
scale_y_continuous(sec.axis = sec_axis(~.*0.04, name="(mm)")) + theme_bw() +
scale_color_manual(values = c("Number of NTS cases"="orange2", "Rainfall"="blue2")) + 
ggtitle("A") + ylab("Cases") + xlab("Month'Year") + 
theme(axis.title.x = element_text(size=0), axis.title.y=element_text(size=10, color="orange2",face="bold"), 
plot.title = element_text(hjust=0,face="bold")) +
theme(axis.text.x=element_text(size=0), axis.title.y.right=element_text(color="blue2", size=10), 
axis.text.y = element_text(face="bold", size=10)) + 
scale_x_date(date_breaks = "24 month", date_labels ="%b'%y") +
theme(legend.justification=c(0.5,0), legend.position=c(0.6,0.7), legend.text=element_text(size=10), 
legend.title=element_text(size=0)) + theme(legend.key.height=unit(1,"line")) + theme(legend.key.width=unit(1,"line"))

E2<-ggplot() + 
geom_line(data=case.iNTS, aes(x=date, y=case_count_tre, color="Number of NTS cases"), stat="identity", size=1.0) + 
geom_line(data=climate.temp, aes(x=date, y=temp_tre/0.4, color="Temperature"), alpha=0.8, size=0.7) + 
scale_y_continuous(sec.axis = sec_axis(~.*0.4, name="(°C)")) + theme_bw() +
scale_color_manual(values=c("Number of NTS cases"="orange2", "Temperature"="green2")) + 
ggtitle("B") + ylab("Cases") + xlab("Month'Year") + 
theme(axis.title.x = element_text(size=10), axis.title.y=element_text(size=10, color="orange2",face="bold"), 
plot.title = element_text(hjust=0,face="bold")) +
theme(axis.text.x=element_text(size=8), axis.title.y.right=element_text(color="green2", size=10), 
axis.text.y=element_text(face="bold", size=10)) + 
scale_x_date(date_breaks = "24 month", date_labels ="%b'%y") +
theme(legend.justification=c(0.5,0), legend.position=c(0.6,0.6), legend.text = element_text(size=10), 
legend.title=element_text(size=0)) + theme(legend.key.height=unit(1,"line")) + theme(legend.key.width=unit(1,"line"))

E3<-ggplot() + 
geom_line(data=case.typhi, aes(x=date, y=case_count_tre, color="Number of typhoid cases"), stat="identity", size=1.0) + 
geom_line(data=climate.rain, aes(x=date, y=rain_tre/0.06, color="Rainfall"), alpha=0.8, size=0.7) + 
scale_y_continuous(sec.axis=sec_axis(~.*0.06, name="(mm)")) + theme_bw() +
scale_color_manual(values=c("Number of typhoid cases"="red2", "Rainfall"="blue2")) + 
ggtitle("C") + ylab("Cases") + xlab("Month'Year") + 
theme(axis.title.x = element_text(size=0), axis.title.y=element_text(size=10, color="red2",face="bold"),
plot.title=element_text(hjust=0,face="bold")) +
theme(axis.text.x=element_text(size=0), axis.title.y.right=element_text(color="blue2", size=10),
axis.text.y = element_text(face="bold", size=10)) + 
scale_x_date(date_breaks = "24 month", date_labels ="%b'%y") +
theme(legend.justification=c(0.5,0), legend.position=c(0.35,0.09), legend.text=element_text(size=10), 
legend.title = element_text(size=0)) + theme(legend.key.height=unit(1,"line")) + theme(legend.key.width=unit(1,"line"))

E4<-ggplot() + 
geom_line(data=case.typhi, aes(x=date, y=case_count_tre, color="Number of typhoid cases"), stat="identity", size=1.0) + 
geom_line(data=climate.temp, aes(x=date, y=temp_tre/0.6, color="Temperature"), alpha=0.8, size = 0.7) + 
scale_y_continuous(sec.axis=sec_axis(~.*0.6, name="(°C)")) + theme_bw() +
scale_color_manual(values=c("Number of typhoid cases"="red2", "Temperature"="green2")) + 
ggtitle("D") + ylab("Cases") + xlab("Month'Year") + 
theme(axis.title.x=element_text(size=10), axis.title.y=element_text(size=10, color="red2",face="bold"), 
plot.title=element_text(hjust=0,face="bold")) +
theme(axis.text.x=element_text(face="bold", size=8), axis.title.y.right = element_text(color="green2", size=10),
axis.text.y = element_text(face="bold", size=10)) + 
scale_x_date(date_breaks="24 month", date_labels="%b'%y") +
theme(legend.justification=c(0.5,0), legend.position=c(0.35,0.09), legend.text=element_text(size=10), 
legend.title = element_text(size=0)) + theme(legend.key.height=unit(1,"line")) + theme(legend.key.width=unit(1,"line"))

grid.arrange(grobs=list(E1, E3, E2, E4), ncol=2, nrow=2)
```

##### Plots of Age-sex distribution of cases (Figure 3)
```{r AgeDistr, results="hide", message=FALSE, warning=FALSE, fig.width=10, fig.height=4, fig.align='center'}
case$sex[case$sex == ""] <- NA
case$age[case$age == ""] <- NA
case$date <- ymd(case$case_date)
case$year <- year(case$date)

agesex.p1 <- ggplot(subset(case, organism=="iNTS" & !is.na(age) & sex != "Unknown"), aes(x=age, color=sex)) + 
geom_freqpoly(position=position_dodge(width=1.5), binwidth=1, size=1) + 
scale_color_manual(values=c(Male="gray40",Female="red3")) + 
theme_bw() + 
scale_x_continuous(limits=c(0, 91), breaks=seq(0, 91, 5)) + 
labs(title="A", x="Age (years)", y="Number of NTS cases") + 
theme(plot.title=element_text(hjust=0,face="bold")) +
theme(axis.text.x=element_text(face="bold", size=10, color="black"), axis.text.y=element_text(face="bold", size=10, color="black")) + 
theme(legend.justification=c(0.5,0), legend.position=c(0.5, 0.6), legend.text=element_text(size=10), legend.title=element_text(size=10)) + 
labs(color="Missing sex: 2,596 (32.3%)") + 
theme(legend.key.height=unit(1,"line")) + 
theme(legend.key.width=unit(1,"line"))

agesex.p2<- ggplot(subset(case, organism=="typhi" & !is.na(age) & sex !="Unknown"), aes(x=age, color=sex)) + 
geom_freqpoly(position=position_dodge(width=1.5), binwidth=1, size=1) + 
scale_color_manual(values=c(Male="gray40",Female="red3")) + 
theme_bw() + 
scale_x_continuous(limits=c(0, 91), breaks=seq(0, 91, 5)) + 
labs(title="B", x="Age (years)", y="Number of typhoid cases") + 
theme(plot.title = element_text(hjust=0,face="bold")) +
theme(axis.text.x=element_text(face="bold", size=10, color="black"), axis.text.y=element_text(face="bold", size=10, color="black")) + 
theme(legend.justification=c(0.5,0), legend.position=c(0.5, 0.6), legend.text=element_text(size=10), legend.title=element_text(size=10)) + 
labs(color="Missing sex: 61 (2.4%)") + 
theme(legend.key.height=unit(1,"line")) + 
theme(legend.key.width=unit(1,"line"))

grid.arrange(grobs=list(agesex.p1, agesex.p2), ncol=2, nrow=1)
```

##### Generating yearly and monthly dynamics
```{r NTS2000.2010}
case.iNTS.spi <- subset(case.iNTS, year(case.iNTS$date)<2011, select=c(date,incid_sea)) 
case.iNTS.spi$month <-month(case.iNTS.spi$date)
case.iNTS.spi$year <- year(case.iNTS.spi$date); case.iNTS.spi$date <- NULL
case.iNTS.spi <- spread(case.iNTS.spi, year, incid_sea); case.iNTS.spi <- as.matrix(case.iNTS.spi)[,-1]
YMD1 <- plot_ly(x=c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010), y=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"), 
z=~case.iNTS.spi, type="contour", colorscale='jet', contours=list(showlabels=TRUE)) %>% 
colorbar(title="NTS incidence per \n 100,000 population") %>%
layout(title="A", xaxis=list(title="Year"), yaxis=list(title="Month"), font=list(size=13))
```

```{r TYP2011.2015}
case.typhi.spi <- subset(case.typhi, year(case.typhi$date)>2010, select=c(date,incid_sea)) 
case.typhi.spi$month <- month(case.typhi.spi$date)
case.typhi.spi$year <- year(case.typhi.spi$date); case.typhi.spi$date <- NULL
case.typhi.spi <- spread(case.typhi.spi, year, incid_sea); case.typhi.spi <- as.matrix(case.typhi.spi)[,-1]
YMD2 <- plot_ly(x = c(2011,2012,2013,2014,2015), y=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"), 
z=~case.typhi.spi, type="contour", colorscale='heatmap', contours=list(showlabels=TRUE)) %>% 
colorbar(title="Typhoid incidence per \n 100,000 population") %>%
layout(title="D", xaxis=list(title="Year"), yaxis=list(title="Month"), font=list(size=13))
```

```{r Rain2000.2010}
climate.rain.spin <- subset(climate.rain, year(climate.rain$date)<2011, select=c(date,rainfall_obs)) 
climate.rain.spin$month <- month(climate.rain.spin$date)
climate.rain.spin$year <- year(climate.rain.spin$date); climate.rain.spin$date <- NULL
climate.rain.spin <- spread(climate.rain.spin, year, rainfall_obs); climate.rain.spin <- as.matrix(climate.rain.spin)[,-1]
YMD3 <- plot_ly(x = c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010), y=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"), 
z=~climate.rain.spin, type="contour", colorscale='heatmap', contours=list(showlabels=TRUE)) %>% colorbar(title="Rainfall (mm)") %>% 
layout(title="B", xaxis=list(title="Year"), yaxis=list(title="Month"), font=list(size=13))
```

```{r Rain2011.2015}
climate.rain.spit <- subset(climate.rain, year(climate.rain$date)>2010, select=c(date,rainfall_obs)) 
climate.rain.spit$month <- month(climate.rain.spit$date)
climate.rain.spit$year <- year(climate.rain.spit$date); climate.rain.spit$date <- NULL
climate.rain.spit <- spread(climate.rain.spit, year, rainfall_obs); climate.rain.spit <- as.matrix(climate.rain.spit)[,-1]
YMD4 <- plot_ly(x = c(2011,2012,2013,2014,2015), y=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"), 
z=~climate.rain.spit, type="contour", colorscale='heatmap', contours=list(showlabels=TRUE)) %>% 
colorbar(title="Rainfall (mm)") %>%
layout(title="E", xaxis=list(title="Year"), yaxis=list(title="Month"), font=list(size=13))
```

```{r Temp2000.2010}
climate.temp.spin <- subset(climate.temp, year(climate.temp$date)<2011, select=c(date,temperature_obs)) 
climate.temp.spin$month <- month(climate.temp.spin$date)
climate.temp.spin$year <- year(climate.temp.spin$date); climate.temp.spin$date <- NULL
climate.temp.spin <- spread(climate.temp.spin, year, temperature_obs); climate.temp.spin <- as.matrix(climate.temp.spin)[,-1]
YMD5 <- plot_ly(x=c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010), y=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"), 
z=~climate.temp.spin, type="contour", colorscale='heatmap', contours=list(showlabels=TRUE)) %>% 
colorbar(title="Temperature (°C)") %>%
layout(title="C", xaxis=list(title="Year"), yaxis=list(title="Month"), font=list(size=13))
```

```{r Temp2011.2015}
climate.temp.spit <- subset(climate.temp, year(climate.temp$date)>2010, select=c(date,temperature_obs)) 
climate.temp.spit$month <- month(climate.temp.spit$date)
climate.temp.spit$year <- year(climate.temp.spit$date); climate.temp.spit$date <- NULL
climate.temp.spit <- spread(climate.temp.spit, year, temperature_obs); climate.temp.spit <- as.matrix(climate.temp.spit)[,-1]
YMD6 <- plot_ly(x=c(2011,2012,2013,2014,2015), y=c("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"), 
z=~climate.temp.spit, type="contour", colorscale='heatmap', contours=list(showlabels=TRUE)) %>%
colorbar(title="Temperature (°C)") %>%
layout(title="F", xaxis=list(title="Year"), yaxis=list(title="Month"), font=list(size = 13))
```

##### Plots of yearly and monthly dynamics (Figure 2)
```{r message=FALSE, warning=FALSE, paged.print=FALSE, fig.align='center', fig.height=5, fig.width=15}
htmltools::tags$div(
style = "display: flex; flex-wrap: wrap",
tags$div(YMD1, style = "width: 33%;"),
tags$div(YMD3, style = "width: 33%;"),
tags$div(YMD5, style = "width: 33%;"),
tags$div(YMD2, style = "width: 33%;"),
tags$div(YMD4, style = "width: 33%;"),
tags$div(YMD6, style = "width: 33%;")
)
```

##### Constructing DLNM datasets for NTS and Typhoid
```{r NTS.TYP.dlnmDS, results="hide", message=FALSE, warning=FALSE}
mo.dlnmN <- bind_cols(case.iNTS, climate.rain, climate.temp, id=NULL)
mo.dlnmN$date1 <- mo.dlnmN$date2 <- NULL
mo.dlnmN <- subset(mo.dlnmN, year(date) < 2011)
mo.dlnmN$time <- seq.int(from = 1, to=132, by=1)
mo.dlnmN$year <- year(mo.dlnmN$date)
mo.dlnmN$month <- month(mo.dlnmN$date)
mo.dlnmN$incid_seaX<-round(mo.dlnmN$incid_sea, digits = 0)
mo.dlnmN$incid_obsX<-round(mo.dlnmN$incid_obs, digits = 0)

mo.dlnmT <- bind_cols(case.typhi, climate.rain, climate.temp, id=NULL)
mo.dlnmT$date1 <- mo.dlnmT$date2 <- NULL
mo.dlnmT <- subset(mo.dlnmT, year(date) > 2010)
mo.dlnmT$time <- seq.int(from = 1, to=60, by=1)
mo.dlnmT$year <- year(mo.dlnmT$date)
mo.dlnmT$month <- month(mo.dlnmT$date)
mo.dlnmT$incid_seaX<-round(mo.dlnmT$incid_sea, digits = 0)
```

##### Switching from AIC to QAIC for NTS and Typhoid
```{r AIC.AIC, results="hide", message=FALSE, warning=FALSE}
nts.quasipoisson <- function(...) { 
  res <- quasipoisson(...)
  res$aic <- poisson(...)$aic 
  res
}
typ.quasipoisson <- function(...) { 
  res <- quasipoisson(...) 
  res$aic <- poisson(...)$aic 
  res
}
```

##### Calculate QAIC values to select optimal models (Supplementary Table)
```{r QAICs, message=FALSE, warning=FALSE, fig.width=10, fig.align='center'}
QAICtable <- data.frame(model.no=rep(NA,27), lag.df=rep(NA,27), fx1.df=rep(NA,27), fx2.df=rep(NA,27), 
                    QAIC.ntsR=rep(NA,27), QAIC.ntsT=rep(NA,27), QAIC.nts=rep(NA,27), QAIC.typR=rep(NA,27), 
                    QAIC.typT=rep(NA,27), QAIC.typ=rep(NA,27))
l=1
for(k in 3:5){
for(j in 3:5){
  for(i in 3:5){
nts.lagknots <- logknots(8, fun="ns", df=i)
nts.varknots.r=equalknots(mo.dlnmN$rainfall_obs, fun="ns", df=j)
nts.varknots.t=equalknots(mo.dlnmN$temperature_obs, fun="ns", df=k)
nts.mo.cb.rain <- crossbasis(mo.dlnmN$rainfall_obs, lag=8, argvar=list(fun="ns", knots=nts.varknots.r), arglag=list(knots=nts.lagknots))
nts.mo.cb.temp <- crossbasis(mo.dlnmN$temperature_obs, lag=8, argvar=list(fun="ns", knots=nts.varknots.t), arglag=list(knots=nts.lagknots))
nts.modelR <- glm(mo.dlnmN$incid_seaX ~ nts.mo.cb.rain + year, family=nts.quasipoisson(), na.action=na.delete, mo.dlnmN)
nts.modelT <- glm(mo.dlnmN$incid_seaX ~ nts.mo.cb.temp + year, family=nts.quasipoisson(), na.action=na.delete, mo.dlnmN)
nts.model <-  glm(mo.dlnmN$incid_seaX ~ nts.mo.cb.rain + nts.mo.cb.temp + year, family = nts.quasipoisson(), na.action=na.delete, mo.dlnmN)

typ.lagknots <- logknots(8, fun="ns", df=i)
typ.varknots.r=equalknots(mo.dlnmT$rainfall_obs, fun="ns", df=j)
typ.varknots.t=equalknots(mo.dlnmT$temperature_obs, fun="ns", df=k)
typ.mo.cb.rain <- crossbasis(mo.dlnmT$rainfall_obs, lag=8, argvar=list(fun="ns", knots=typ.varknots.r), arglag=list(knots=typ.lagknots))
typ.mo.cb.temp <- crossbasis(mo.dlnmT$temperature_obs, lag =8, argvar = list(fun="ns", knots=typ.varknots.t), arglag=list(knots=typ.lagknots))
typ.modelR <- glm(mo.dlnmT$incid_seaX ~ typ.mo.cb.rain + year, family = typ.quasipoisson(), na.action=na.delete, mo.dlnmT)
typ.modelT <- glm(mo.dlnmT$incid_seaX ~ typ.mo.cb.temp + year, family = typ.quasipoisson(), na.action=na.delete, mo.dlnmT)
typ.model <- glm(mo.dlnmT$incid_seaX ~ typ.mo.cb.rain + typ.mo.cb.temp + year, family = typ.quasipoisson(), na.action=na.delete, mo.dlnmT)

QAICtable[l,] <- c(l,i,j,k, QAIC(nts.modelR, chat=summary(nts.modelR)$dispersion), QAIC(nts.modelT, chat=summary(nts.modelT)$dispersion), 
                   QAIC(nts.model, chat=summary(nts.model)$dispersion), QAIC(typ.modelR, chat=summary(typ.modelR)$dispersion), QAIC(typ.modelT, chat=summary(typ.modelT)$dispersion), 
                   QAIC(typ.model, chat=1))
l=l+1  
  }
}
  }
kable(QAICtable)
```

##### Reformulate cross-basis matrix using selected best NTS model
```{r cross.basisNTS, results="hide", message=FALSE, warning=FALSE}
sort(mo.dlnmN$rainfall_obs, decreasing=FALSE)
sort(mo.dlnmN$temperature_obs, decreasing=FALSE)
nts.lagknots.r <- logknots(8, fun="ns", df=3)
nts.varknots.r=equalknots(mo.dlnmN$rainfall_obs, fun="ns", df=3)
nts.lagknots.t <- logknots(8, fun="ns", df=3)
nts.varknots.t=equalknots(mo.dlnmN$temperature_obs, fun="ns", df=3)
nts.cb.rain <- crossbasis(mo.dlnmN$rainfall_obs, lag=8, argvar=list(fun="ns", knots=nts.varknots.r), arglag=list(knots=nts.lagknots.r))
nts.cb.temp <- crossbasis(mo.dlnmN$temperature_obs, lag=8, argvar=list(fun="ns", knots=nts.varknots.t), arglag=list(knots=nts.lagknots.t))
summary(nts.cb.rain)
summary(nts.cb.temp)
```

##### Fit NTS model
```{r FitNTS, results="hide", message=FALSE, warning=FALSE}
nts.model <- glm(mo.dlnmN$incid_seaX ~ nts.cb.rain + nts.cb.temp + year, family=quasipoisson(), na.action=na.delete, mo.dlnmN)
```

##### Investigate NTS deviance residuals
```{r devianceNTS, results="hide", message=FALSE, warning=FALSE, fig.width=9, fig.height=4, fig.align='center'}
par(mfrow=c(1,2))
pacf(residuals(nts.model,type="deviance"), na.action=na.omit, main="Original model with Rain & Temp", xlim=c(0,8))
nts.model <- update(nts.model,.~.+Lag(residuals(nts.model,type="deviance"), 1)) #add residuals at lag 1 
pacf(residuals(nts.model,type="deviance"), na.action=na.omit, main="Adjusted model with Rain & Temp", xlim=c(0,8))
```

##### Run NTS predictions
```{r predictrunNTS, results="hide", message=FALSE, warning=FALSE}
nts.pred.rain <- crosspred(nts.cb.rain, nts.model, cen=0, by=0.2)
nts.pred.temp <- crosspred(nts.cb.temp, nts.model, cen=23, by=0.2)
```

```{r plotContourNTS, message=FALSE, warning=FALSE, include=FALSE, results="hide"}
jpeg("nts.pred.rain.png", width=900,height=600)
plot(nts.pred.rain, "contour", key.title=title("NTS"), plot.title=title("", xlab ="Rainfall (mm)", ylab = "Lag (month)", cex.lab=1.7, cex.axis=1.7))
dev.off()
jpeg("nts.pred.temp.png", width=900,height=600)
plot(nts.pred.temp, "contour", key.title=title("NTS"), plot.title=title("", xlab ="Temperature (°C)", ylab = "Lag (month)", cex.lab=1.7, cex.axis=1.7))
dev.off()
plot(load.image("nts.pred.rain.png"), main="B")
plot(load.image("nts.pred.temp.png"), main="B")
```

##### Plots of NTS predictions due to rainfall (Figure 4)
```{r predictRainNTS, results="hide", message=FALSE, warning=FALSE, fig.align='center', fig.height=8, fig.width=12}
par(mfrow=c(2,2))
plot(nts.pred.rain, xlab="Rainfall (mm)", ylab="Lag (month)", zlab="RR of NTS", theta=150, phi=5, lphi=100, cex.lab=1.1, cex.axis=1.1, col="gray80",main="A")
plot(nts.pred.rain, "slices", xlab="Rainfall (mm) [given lag 2]", lag=c(2), col="orange2", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95, ci='b', lwd=4.5, ylab="RR of NTS", cex.lab=1.1, cex.axis=1.1,main="B")
plot(nts.pred.rain, "slices", xlab="lag (month) [given 9 mm] ", var=c(9), col="orange2", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95, ci='b', lwd=4.5, ylab="RR of NTS", cex.lab=1.1, cex.axis=1.1,main="C")
plot(nts.pred.rain, "slices", xlab="lag (month) [given 13 mm] ", var=c(13), col="orange2", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95, ci='b', lwd=4.5, ylab="RR of NTS", cex.lab=1.1, cex.axis=1.1,main="D")
```

##### Plots of NTS predictions due to temperature (Figure 6)
```{r predictTempNTS, results="hide", message=FALSE, warning=FALSE, fig.align='center', fig.height=8, fig.width=12}
par(mfrow=c(2,2))
plot(nts.pred.temp, xlab="Temperature (°C)", ylab="Lag (month)", zlab="RR of NTS", theta=150, phi=5, lphi=100, cex.lab=1, cex.axis=1, col="gray80",main="A")
plot(nts.pred.temp, xlab="Temperature (°C) [given lag 3]", "slices",lag=c(3), col="orange2", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95, ci='b',lwd=4.5, ylab="RR of NTS", cex.lab=1.1, cex.axis=1.1,main="B")
plot(nts.pred.temp, xlab="Lag (month) [given 19 °C]", "slices",var=c(19), col="orange2", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95, ci='b',lwd=4.5, ylab="RR of NTS", cex.lab=1.1, cex.axis=1.1,main="C")
plot(nts.pred.temp, xlab="Lag (month) [given 29 °C]", "slices",var=c(29), col="orange2", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95, ci='b',lwd=4.5, ylab="RR of NTS", cex.lab=1.1, cex.axis=1.1,main="D")
```

##### Reformulate cross-basis matrix using selected best Typhoid models
```{r cross.basisTYP, results="hide", message=FALSE, warning=FALSE}
sort(mo.dlnmT$rainfall_obs, decreasing=FALSE)
sort(mo.dlnmT$temperature_obs, decreasing=FALSE)
typ.lagknots <- logknots(8, fun="ns", df=3)
typ.varknots.r1 <- equalknots(mo.dlnmT$rainfall_obs, fun="ns", df=4)
typ.varknots.r2 <- equalknots(mo.dlnmT$rainfall_obs, fun="ns", df=3)
typ.varknots.t <- equalknots(mo.dlnmT$temperature_obs, fun="ns", df=3)
typ.cb.rain1 <- crossbasis(mo.dlnmT$rainfall_obs, lag=8, argvar=list(fun="ns", knots=typ.varknots.r1), arglag=list(knots=typ.lagknots))
typ.cb.rain2 <- crossbasis(mo.dlnmT$rainfall_obs, lag=8, argvar=list(fun="ns", knots=typ.varknots.r2), arglag=list(knots=typ.lagknots))
typ.cb.temp <- crossbasis(mo.dlnmT$temperature_obs, lag=8, argvar=list(fun="ns", knots=typ.varknots.t), arglag=list(knots=typ.lagknots))
summary(typ.cb.rain1)
summary(typ.cb.rain2)
summary(typ.cb.temp)
```

##### Fit Typhoid models
```{r FitTYP, results="hide", message=FALSE, warning=FALSE}
typ.modelR <- glm(mo.dlnmT$incid_seaX ~ typ.cb.rain1 + year, family=quasipoisson(), na.action=na.delete, mo.dlnmT)
typ.modelT <- glm(mo.dlnmT$incid_seaX ~ typ.cb.temp + typ.cb.rain2 + year, family=quasipoisson(), na.action=na.delete, mo.dlnmT)
```

##### Investigate deviance residuals for fitted tyhpoid models
```{r devianceTYP, results="hide", message=FALSE, warning=FALSE, fig.width=8, fig.height=3, fig.align='center'}
par(mfrow=c(1,3))
pacf(residuals(typ.modelR,type="deviance"),na.action=na.omit,main="Original model with Rain",xlim=c(0,8))
pacf(residuals(typ.modelT,type="deviance"),na.action=na.omit,main="Original model with Rain & Temp",xlim=c(0,8))
typ.modelT <- update(typ.modelT,.~.+Lag(residuals(typ.modelT,type="deviance"),1)) #add residuals at lag 1
pacf(residuals(typ.modelT,type="deviance"),na.action=na.omit,main="Adjusted model with Rain & Temp",xlim=c(0,8))
```

##### Run typhoid predictions
```{r predictrunTYP, results="hide", message=FALSE, warning=FALSE}
typ.pred.rain <- crosspred(typ.cb.rain1, typ.modelR, cen=0, by=0.2)
typ.pred.temp <- crosspred(typ.cb.temp, typ.modelT, cen=23, by=0.2)
```

```{r plotContourTYP, message=FALSE, warning=FALSE, include=FALSE, results="hide"}
jpeg("typ.pred.rain.png", width=900,height=600)
plot(typ.pred.rain, "contour", key.title=title("TYP"), plot.title=title("", xlab ="Rainfall (mm)", ylab = "Lag (month)", cex.lab=1.7, cex.axis=1.7))
dev.off()
jpeg("typ.pred.temp.png", width=900,height=600)
plot(typ.pred.temp, "contour", key.title=title("TYP"), plot.title=title("", xlab ="Temperature (°C)", ylab = "Lag (month)", cex.lab=1.7, cex.axis=1.7))
dev.off()
plot(load.image("typ.pred.rain.png"), main="B")
plot(load.image("typ.pred.temp.png"), main="B")
```

##### Plots of TYP predictions due to rainfall (Figure 5)
```{r predictRainTYP, results="hide", message=FALSE, warning=FALSE, fig.align='center', fig.height=8, fig.width=12}
par(mfrow=c(2,2))
plot(typ.pred.rain, xlab="Rainfall (mm)", ylab="Lag (month)", zlab="RR of typhoid", theta=210, phi=10, lphi=150, col="gray80", main="A", cex.lab=1.1, cex.axis=1.1)
plot(typ.pred.rain, xlab="Rainfall (mm) [given lag 4]", "slices", lag=c(4), col="red2", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab="RR of typhoid", cex.lab=1.1, cex.axis=1.1,main="B")
plot(typ.pred.rain, xlab="Lag (month) [given 9 mm]", "slices", var=c(9), col="red2", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab="RR of typhoid", cex.lab=1.1, cex.axis=1.1,main="C")
plot(typ.pred.rain, xlab="Lag (month) [given 16 mm]", "slices", var=c(16), col="red2", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab="RR of typhoid", cex.lab=1.1, cex.axis=1.1,main="D")
```

##### Plots of TYP predictions due to temperature (Figure 7)
```{r predictTempTYP, results="hide", message=FALSE, warning=FALSE, fig.align='center', fig.height=8, fig.width=12}
par(mfrow=c(2,3))
plot(typ.pred.temp, xlab="Temperature (°C)", ylab="Lag (month)", zlab="RR of typhoid", theta=150, phi=5, lphi=100, col="gray80", main="A", cex.lab=1.1, cex.axis=1.1)
plot(typ.pred.temp, xlab="Temperature (°C) [given lag 2]", "slices", lag=c(2), col="red2", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab="RR of typhoid", cex.lab=1.1, cex.axis=1.1,main="B")
plot(typ.pred.temp, xlab="Temperature (°C) [given lag 5]", "slices", lag=c(5), col="red2", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab="RR of typhoid", cex.lab=1.1, cex.axis=1.1,main="C")
plot(typ.pred.temp, xlab="Lag (month) [given 19 °C]", "slices", var=c(19), col="red2", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab="RR of typhoid", cex.lab=1.1, cex.axis=1.1,main="D")
plot(typ.pred.temp, xlab="Lag (month) [given 25 °C]", "slices", var=c(25), col="red2", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab="RR of typhoid", cex.lab=1.1, cex.axis=1.1,main="E")
```

##### Plots of validation checks (Supplementary Figure S4)
```{r validationCheck, results="hide", message=FALSE, warning=FALSE, fig.width=12, fig.height=8, fig.align='center'}
par(mfrow=c(3,4))
plot(mo.dlnmN$date, residuals(nts.model,type="deviance"), pch=19, cex=0.8, col=grey(0.4),main="A", ylab="Residuals",xlab="",cex.lab=1.2,cex.axis=1.2) 
abline(h=0,lty=2,lwd=3)
pacf(residuals(nts.model,type="deviance"),na.action=na.omit,main="B",xlim=c(0,8),xlab="", cex.lab=1.2,cex.axis=1.2)
acf(residuals(nts.model,type="deviance"),na.action=na.omit,main="C",xlim=c(0,8),xlab="", cex.lab=1.2,cex.axis=1.2)
plot(matrix(mo.dlnmN$incid_seaX),matrix(predict(nts.model, type="response")), col=c("orange2","gray2"),xlab="Predicted NTS incidence", ylab="Observed NTS incidence",pch=19,cex=0.8,cex.lab=1.2,cex.axis=1.2)
legend("topleft", legend=c("observed", "predicted"), col=c("grey30", "orange2"), cex=0.8, pch=19)

plot(mo.dlnmT$date, residuals(typ.modelR,type="deviance"), pch=19, cex=0.8, col=grey(0.6),main="E", ylab="Residuals",xlab="",cex.lab=1.2,cex.axis=1.2)
abline(h=0,lty=2,lwd=3)
pacf(residuals(typ.modelR,type="deviance"),na.action=na.omit,main="F",xlim=c(0,8),xlab="",cex.lab=1.2, cex.axis=1.2)
acf(residuals(typ.modelR,type="deviance"),na.action=na.omit,main="G",xlim=c(0,8),xlab="",cex.lab=1.2, cex.axis=1.2)
plot(matrix(mo.dlnmT$incid_seaX),matrix(predict(typ.modelR, type="response")), col=c("red2","gray2"),xlab="Predicted typhoid incidence", ylab="Observed typhoid incidence",pch=19,cex=0.8,cex.lab=1.2,cex.axis=1.2)
legend("topleft", legend=c("observed", "predicted"), col=c("grey30", "red2"), cex=0.8, pch=19)

plot(mo.dlnmT$date, residuals(typ.modelT,type="deviance"), pch=19, cex=0.8, col=grey(0.6),main="I", ylab="Residuals", xlab="Year",cex.lab=1.2,cex.axis=1.2) 
abline(h=0,lty=2,lwd=3)
pacf(residuals(typ.modelT,type="deviance"),na.action=na.omit,main="J",xlim=c(0,8),xlab="Lag (month)",cex.lab=1.2, cex.axis=1.2)
acf(residuals(typ.modelT,type="deviance"),na.action=na.omit,main="K",xlim=c(0,8),xlab="Lag (month)",cex.lab=1.2, cex.axis=1.2)
plot(matrix(mo.dlnmT$incid_seaX),matrix(predict(typ.modelT, type="response")), col=c("red2","gray2"),xlab="Predicted typhoid incidence", ylab="Observed typhoid incidence",pch=19,cex=0.8,cex.lab=1.2,cex.axis=1.2)
legend("topleft", legend=c("observed", "predicted"), col=c("grey30", "red2"), cex=0.8, pch=19)
```

##### Plots of predictions due to rainfall/temperature (Table 1)
```{r predictEstimates, fig.align='center', message=FALSE, warning=FALSE}
RRTable <- data.frame(rbind(nts.pred.rain$matRRfit["9",], nts.pred.rain$matRRlow["9",], nts.pred.rain$matRRhigh["9",],
                 nts.pred.rain$matRRfit["13",],nts.pred.rain$matRRlow["13",],nts.pred.rain$matRRhigh["13",],
                 nts.pred.temp$matRRfit["19",],nts.pred.temp$matRRlow["19",],nts.pred.temp$matRRhigh["19",],
                 nts.pred.temp$matRRfit["29",],nts.pred.temp$matRRlow["29",],nts.pred.temp$matRRhigh["29",],
                 typ.pred.rain$matRRfit["9",],typ.pred.rain$matRRlow["9",],typ.pred.rain$matRRhigh["9",],
                 typ.pred.rain$matRRfit["16",],typ.pred.rain$matRRlow["16",],typ.pred.rain$matRRhigh["16",],
                 typ.pred.temp$matRRfit["19",],typ.pred.temp$matRRlow["19",],typ.pred.temp$matRRhigh["19",],
                 typ.pred.temp$matRRfit["25",],typ.pred.temp$matRRlow["25",],typ.pred.temp$matRRhigh["25",]
                 ))
kable(RRTable)
```


##### Vary degrees of freedom for sensitivity analyses of NTS/typhoid predictions
```{r sensitivityDF, results="hide", message=FALSE, warning=FALSE}
nts.cb.rain <- list()
nts.cb.temp <- list()
typ.cb.rain <- list()
typ.cb.temp <- list()
sort(mo.dlnmN$rainfall_obs, decreasing=FALSE)
sort(mo.dlnmN$temperature_obs, decreasing=FALSE)
sort(mo.dlnmT$rainfall_obs, decreasing=FALSE)
sort(mo.dlnmT$temperature_obs, decreasing=FALSE)
l=1
for(k in 3:5){
  for(j in 3:5){
    for(i in 3:5){
nts.lagknots <- logknots(8, fun="ns", df=i)
nts.varknots.r=equalknots(mo.dlnmN$rainfall_obs, fun="ns", df=j)
nts.varknots.t=equalknots(mo.dlnmN$temperature_obs, fun="ns", df=k)
nts.cb.rain[[l]] <- crossbasis(mo.dlnmN$rainfall_obs, lag=8, argvar=list(fun="ns", knots=nts.varknots.r), arglag=list(knots=nts.lagknots))
nts.cb.temp[[l]] <- crossbasis(mo.dlnmN$temperature_obs, lag=8, argvar=list(fun="ns", knots=nts.varknots.t), arglag=list(knots=nts.lagknots))

typ.lagknots <- logknots(8, fun="ns", df=i)
typ.varknots.r=equalknots(mo.dlnmT$rainfall_obs, fun="ns", df=j)
typ.varknots.t=equalknots(mo.dlnmT$temperature_obs, fun="ns", df=k)
typ.cb.rain[[l]] <- crossbasis(mo.dlnmT$rainfall_obs, lag=8, argvar=list(fun="ns", knots=typ.varknots.r), arglag=list(knots=typ.lagknots))
typ.cb.temp[[l]] <- crossbasis(mo.dlnmT$temperature_obs, lag =8, argvar = list(fun="ns", knots=typ.varknots.t), arglag=list(knots=typ.lagknots))
  
  l=l+1  
  }
  }
}
```

##### Formulate alternative sensitivity models and plot predictions of NTS (Supplementay Figure S5)
```{r sensitivityNTS, results="hide", message=FALSE, warning=FALSE, fig.width=12, fig.height=5, fig.align='center'}
nts.cb.rain.s1 <- nts.cb.rain[[2]]; nts.cb.temp.s1 <- nts.cb.temp[[2]]
nts.cb.rain.s2 <- nts.cb.rain[[3]]; nts.cb.temp.s2 <- nts.cb.temp[[3]]
nts.cb.rain.s3 <- nts.cb.rain[[4]]; nts.cb.temp.s3 <- nts.cb.temp[[4]]
nts.cb.rain.s4 <- nts.cb.rain[[7]]; nts.cb.temp.s4 <- nts.cb.temp[[7]]
nts.cb.rain.s5 <- nts.cb.rain[[10]]; nts.cb.temp.s5 <- nts.cb.temp[[10]]
nts.cb.rain.s6 <- nts.cb.rain[[19]]; nts.cb.temp.s6 <- nts.cb.temp[[19]]

nts.model.s1 <- glm(incid_seaX~nts.cb.rain.s1 + nts.cb.temp.s1 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)
nts.model.s2 <- glm(incid_seaX~nts.cb.rain.s2 + nts.cb.temp.s2 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)
nts.model.s3 <- glm(incid_seaX~nts.cb.rain.s3 + nts.cb.temp.s3 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)
nts.model.s4 <- glm(incid_seaX~nts.cb.rain.s4 + nts.cb.temp.s4 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)
nts.model.s5 <- glm(incid_seaX~nts.cb.rain.s5 + nts.cb.temp.s5 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)
nts.model.s6 <- glm(incid_seaX~nts.cb.rain.s6 + nts.cb.temp.s6 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)

nts.model.s1 <- update(nts.model.s1,.~.+Lag(residuals(nts.model.s1,type="deviance"),1)) #add residuals at lag 1
nts.model.s2 <- update(nts.model.s2,.~.+Lag(residuals(nts.model.s2,type="deviance"),1)) #to correct for partial
nts.model.s3 <- update(nts.model.s3,.~.+Lag(residuals(nts.model.s3,type="deviance"),1)) #autocorrelation
nts.model.s4 <- update(nts.model.s4,.~.+Lag(residuals(nts.model.s4,type="deviance"),1)) 
nts.model.s5 <- update(nts.model.s5,.~.+Lag(residuals(nts.model.s5,type="deviance"),1)) 
nts.model.s6 <- update(nts.model.s6,.~.+Lag(residuals(nts.model.s6,type="deviance"),1)) 

nts.pred.rain.s1 <- crosspred(nts.cb.rain.s1, nts.model.s1, cen=0, by=0.2)
nts.pred.rain.s2 <- crosspred(nts.cb.rain.s2, nts.model.s2, cen=0, by=0.2)
nts.pred.rain.s3 <- crosspred(nts.cb.rain.s3, nts.model.s3, cen=0, by=0.2)
nts.pred.rain.s4 <- crosspred(nts.cb.rain.s4, nts.model.s4, cen=0, by=0.2)
nts.pred.rain.s5 <- crosspred(nts.cb.rain.s5, nts.model.s5, cen=0, by=0.2)
nts.pred.rain.s6 <- crosspred(nts.cb.rain.s6, nts.model.s6, cen=0, by=0.2)

nts.pred.temp.s1 <- crosspred(nts.cb.temp.s1, nts.model.s1, cen=23, by=0.2)
nts.pred.temp.s2 <- crosspred(nts.cb.temp.s2, nts.model.s2, cen=23, by=0.2)
nts.pred.temp.s3 <- crosspred(nts.cb.temp.s3, nts.model.s3, cen=23, by=0.2)
nts.pred.temp.s4 <- crosspred(nts.cb.temp.s4, nts.model.s4, cen=23, by=0.2)
nts.pred.temp.s5 <- crosspred(nts.cb.temp.s5, nts.model.s5, cen=23, by=0.2)
nts.pred.temp.s6 <- crosspred(nts.cb.temp.s6, nts.model.s6, cen=23, by=0.2)

par(mfrow=c(2,6))
plot(nts.pred.rain.s1,"slices",var=c(9),col="orange2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="A")
plot(nts.pred.rain.s2,"slices",var=c(9),col="orange2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="C")
plot(nts.pred.rain.s3,"slices",var=c(9),col="orange2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="E")
plot(nts.pred.rain.s4,"slices",var=c(9),col="orange2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="G")
plot(nts.pred.rain.s5,"slices",var=c(9),col="orange2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="I")
plot(nts.pred.rain.s6,"slices",var=c(9),col="orange2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="K")

plot(nts.pred.temp.s1,"slices",var=c(19),col="orange2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="B")
plot(nts.pred.temp.s2,"slices",var=c(19),col="orange2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="D")
plot(nts.pred.temp.s3,"slices",var=c(19),col="orange2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="F")
plot(nts.pred.temp.s4,"slices",var=c(19),col="orange2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="H")
plot(nts.pred.temp.s5,"slices",var=c(19),col="orange2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="J")
plot(nts.pred.temp.s6,"slices",var=c(19),col="orange2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of NTS",cex.lab=1.1,cex.axis=1.1,main="L")
```

##### Formulate alternative sensitivity models and plot predictions of Typhoid (Supplementay Figure S6)
```{r sensitivityTyp, results="hide", message=FALSE, warning=FALSE, fig.width=12, fig.height = 5, fig.align='center'}
typ.cb.rain.s1 <- typ.cb.rain[[2]]; typ.cb.temp.s1 <- typ.cb.temp[[2]]
typ.cb.rain.s2 <- typ.cb.rain[[3]]; typ.cb.temp.s2 <- typ.cb.temp[[3]]
typ.cb.rain.s3 <- typ.cb.rain[[4]]; typ.cb.temp.s3 <- typ.cb.temp[[4]]
typ.cb.rain.s4 <- typ.cb.rain[[7]]; typ.cb.temp.s4 <- typ.cb.temp[[7]]
typ.cb.rain.s5 <- typ.cb.rain[[10]]; typ.cb.temp.s5 <- typ.cb.temp[[10]]
typ.cb.rain.s6 <- typ.cb.rain[[19]]; typ.cb.temp.s6 <- typ.cb.temp[[19]]

typ.modelR.s1 <- glm(incid_seaX~typ.cb.rain.s1 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelR.s2 <- glm(incid_seaX~typ.cb.rain.s2 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelR.s3 <- glm(incid_seaX~typ.cb.rain.s3 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelR.s4 <- glm(incid_seaX~typ.cb.rain.s4 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelR.s5 <- glm(incid_seaX~typ.cb.rain.s5 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelR.s6 <- glm(incid_seaX~typ.cb.rain.s6 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelT.s1 <- glm(incid_seaX~typ.cb.rain.s1 + typ.cb.temp.s1 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelT.s2 <- glm(incid_seaX~typ.cb.rain.s2 + typ.cb.temp.s2 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelT.s3 <- glm(incid_seaX~typ.cb.rain.s3 + typ.cb.temp.s3 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelT.s4 <- glm(incid_seaX~typ.cb.rain.s4 + typ.cb.temp.s4 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelT.s5 <- glm(incid_seaX~typ.cb.rain.s5 + typ.cb.temp.s5 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
typ.modelT.s6 <- glm(incid_seaX~typ.cb.rain.s6 + typ.cb.temp.s6 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)
	
typ.modelR.s1 <- update(typ.modelR.s1,.~.+Lag(residuals(typ.modelR.s1,type="deviance"),1))
typ.modelR.s1 <- update(typ.modelR.s1,.~.+Lag(residuals(typ.modelR.s1,type="deviance"),2))
typ.modelR.s1 <- update(typ.modelR.s1,.~.+Lag(residuals(typ.modelR.s1,type="deviance"),3))
typ.modelR.s1 <- update(typ.modelR.s1,.~.+Lag(residuals(typ.modelR.s1,type="deviance"),4))
typ.modelR.s2 <- update(typ.modelR.s2,.~.+Lag(residuals(typ.modelR.s2,type="deviance"),1)) 
typ.modelR.s2 <- update(typ.modelR.s2,.~.+Lag(residuals(typ.modelR.s2,type="deviance"),2))
typ.modelR.s2 <- update(typ.modelR.s2,.~.+Lag(residuals(typ.modelR.s2,type="deviance"),3))
typ.modelR.s5 <- update(typ.modelR.s5,.~.+Lag(residuals(typ.modelR.s5,type="deviance"),1)) 
typ.modelR.s5 <- update(typ.modelR.s5,.~.+Lag(residuals(typ.modelR.s5,type="deviance"),2))
typ.modelR.s5 <- update(typ.modelR.s5,.~.+Lag(residuals(typ.modelR.s5,type="deviance"),3))
typ.modelR.s6 <- update(typ.modelR.s6,.~.+Lag(residuals(typ.modelR.s6,type="deviance"),1)) 
typ.modelR.s6 <- update(typ.modelR.s6,.~.+Lag(residuals(typ.modelR.s6,type="deviance"),2)) 
typ.modelR.s6 <- update(typ.modelR.s6,.~.+Lag(residuals(typ.modelR.s6,type="deviance"),3)) 

typ.modelT.s1 <- update(typ.modelT.s1,.~.+Lag(residuals(typ.modelT.s1,type="deviance"),1))
typ.modelT.s1 <- update(typ.modelT.s1,.~.+Lag(residuals(typ.modelT.s1,type="deviance"),3))
typ.modelT.s2 <- update(typ.modelT.s2,.~.+Lag(residuals(typ.modelT.s2,type="deviance"),1)) 
typ.modelT.s3 <- update(typ.modelT.s3,.~.+Lag(residuals(typ.modelT.s3,type="deviance"),1)) 
typ.modelT.s4 <- update(typ.modelT.s4,.~.+Lag(residuals(typ.modelT.s4,type="deviance"),1)) 
typ.modelT.s4 <- update(typ.modelT.s4,.~.+Lag(residuals(typ.modelT.s4,type="deviance"),2)) 
typ.modelT.s5 <- update(typ.modelT.s5,.~.+Lag(residuals(typ.modelT.s5,type="deviance"),1)) 
typ.modelT.s5 <- update(typ.modelT.s5,.~.+Lag(residuals(typ.modelT.s5,type="deviance"),4))
typ.modelT.s5 <- update(typ.modelT.s5,.~.+Lag(residuals(typ.modelT.s5,type="deviance"),3))
typ.modelT.s6 <- update(typ.modelT.s6,.~.+Lag(residuals(typ.modelT.s6,type="deviance"),1)) 

typ.pred.rain.s1 <- crosspred(typ.cb.rain.s1, typ.modelR.s1, cen=0, by=0.2)
typ.pred.rain.s2 <- crosspred(typ.cb.rain.s2, typ.modelR.s2, cen=0, by=0.2)
typ.pred.rain.s3 <- crosspred(typ.cb.rain.s3, typ.modelR.s3, cen=0, by=0.2)
typ.pred.rain.s4 <- crosspred(typ.cb.rain.s4, typ.modelR.s4, cen=0, by=0.2)
typ.pred.rain.s5 <- crosspred(typ.cb.rain.s5, typ.modelR.s5, cen=0, by=0.2)
typ.pred.rain.s6 <- crosspred(typ.cb.rain.s6, typ.modelR.s6, cen=0, by=0.2)

typ.pred.temp.s1 <- crosspred(typ.cb.temp.s1, typ.modelT.s1, cen=23, by=0.2)
typ.pred.temp.s2 <- crosspred(typ.cb.temp.s2, typ.modelT.s2, cen=23, by=0.2)
typ.pred.temp.s3 <- crosspred(typ.cb.temp.s3, typ.modelT.s3, cen=23, by=0.2)
typ.pred.temp.s4 <- crosspred(typ.cb.temp.s4, typ.modelT.s4, cen=23, by=0.2)
typ.pred.temp.s5 <- crosspred(typ.cb.temp.s5, typ.modelT.s5, cen=23, by=0.2)
typ.pred.temp.s6 <- crosspred(typ.cb.temp.s6, typ.modelT.s6, cen=23, by=0.2)
	
par(mfrow=c(2,6))
plot(typ.pred.rain.s1,"slices",var=c(9),col="red2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="A")
plot(typ.pred.rain.s2,"slices",var=c(9),col="red2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="C")
plot(typ.pred.rain.s3,"slices",var=c(9),col="red2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="E")
plot(typ.pred.rain.s4,"slices",var=c(9),col="red2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="G")
plot(typ.pred.rain.s5,"slices",var=c(9),col="red2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="I")
plot(typ.pred.rain.s6,"slices",var=c(9),col="red2",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 9 mm)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="K")
	
plot(typ.pred.temp.s1,"slices",var=c(19),col="red2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR oftyphoid",cex.lab=1.1,cex.axis=1.1,main="B")
plot(typ.pred.temp.s2,"slices",var=c(19),col="red2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="D")
plot(typ.pred.temp.s3,"slices",var=c(19),col="red2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="F")
plot(typ.pred.temp.s4,"slices",var=c(19),col="red2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="H")
plot(typ.pred.temp.s5,"slices",var=c(19),col="red2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="J")
plot(typ.pred.temp.s6,"slices",var=c(19),col="red2",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab="Month-lag (given 19 °C)",ylab="RR of typhoid",cex.lab=1.1,cex.axis=1.1,main="L")
```

