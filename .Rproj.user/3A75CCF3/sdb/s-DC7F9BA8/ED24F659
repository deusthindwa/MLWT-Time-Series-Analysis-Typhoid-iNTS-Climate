{
    "collab_server" : "",
    "contents" : "---\ntitle: Impact of Climate on the Risk of Non-typhoid Salmonellosis and Typhoid Fever\n  in Blantyre, Malawi; A Distributed Lag Non-linear Modelling Study.\nauthor: \"By Deus Thindwa\"\ndate: \"08/02/2019\"\noutput:\n  html_document: default\n  pdf_document: default\n  word_document: default\n---\n\n<style type=\"text/css\">\n.main-container {\n  max-width: 1300px;\n  margin-left: auto;\n  margin-right: auto;\n}\n</style>\n\n##### Load required packages for entire analysis\n```{r LoadPackages, results='hide', message=FALSE, warning=FALSE}\ndlnm.pkg <- c(\"tidyverse\", \"lubridate\",\"xts\",\"ggthemes\",\"PerformanceAnalytics\",\"reshape2\",\"rugarch\",\"timetk\",\"parallel\",\"timeSeries\",\"tseries\",\"data.table\",\"ggplot2\",\"dlnm\",\"broom\",\"caret\",\"gridExtra\",\"splines\",\"splines2\",\"pspline\",\"cowplot\",\"mgcv\",\"spi\",\"chron\",\"gridGraphics\",\"grid\",\"pscl\",\"MASS\", \"AER\", \"Hmisc\", \"MuMIn\", \"VGAM\", \"forecast\", \"seasonal\", \"plotly\", \"ggmap\", \"rgeos\", \"tmap\", \"maptools\", \"maps\", \"ggfortify\", \"htmltools\",\"webshot\",\"knitr\",\"flexdashboard\", \"imager\", \"httr\", \"curl\", \"here\")\n\nlapply(dlnm.pkg, library, character.only=TRUE)\n``` \n\n##### Load Malawi map dataset\n```{r LoadMWMap, results=\"hide\"}\ndlnmtmp <- tempfile()\ndownload.file(\"https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/malawi_map.zip\", destfile=dlnmtmp)\nunzip(dlnmtmp, exdir = \".\")\nmalawi.map <- rgdal::readOGR(\".\",\"malawi_map\")\n```\n\n##### Subset Blantyre map from Malawi map\n```{r CropBTMap, results=\"hide\"}\nblantyre1.map <- malawi.map@data$OBJECTID >289 & malawi.map@data$OBJECTID <297 \nblantyre2.map <- malawi.map@data$OBJECTID >308 & malawi.map@data$OBJECTID <311\nblantyre3.map <- malawi.map@data$OBJECTID >342\n```\n\n##### Convert shape files into dataframe\n```{r SFtoDF, results=\"hide\", message=FALSE, warning=FALSE}\nblantyre.map <- rbind(fortify(malawi.map[blantyre1.map,]), fortify(malawi.map[blantyre2.map,]), fortify(malawi.map[blantyre3.map,]))\nblantyre.map$id <- as.integer(blantyre.map$id)\n```\n\n##### Load Blantyre demographics' and features' dataset\n```{r LoadDemoDS, results=\"hide\", message=FALSE, warning=FALSE}\nblantyre.demog <- read.csv(curl(\"https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/blantyre_demog.csv\"))\n\tmap.features <- read.csv(curl(\"https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/blantyre_features.csv\"))\n\tblantyre.demog$id <- as.integer(blantyre.demog$id)\n\tmap.all <- merge(x=blantyre.map, y=blantyre.demog, by=\"id\", x.all=TRUE)\n\trm(list = ls()[grep(\"^blantyre\", ls())])\n```\n\n##### Plot the map of Blantyre (Figure 1)\n```{r PlotBTMap, message=FALSE, warning=FALSE, fig.width=8, fig.height = 5, fig.align='center'}\nggplot() + \ngeom_polygon(data=map.all,aes(x=long,y=lat,group=group,fill=popc),colour=\"gray50\") + \ntheme_classic() + \ntheme(axis.text.x=element_text(face=\"bold\", size=10, color=\"black\"), axis.text.y=element_text(face=\"bold\", size=10, color=\"black\")) + \nlabs(fill=\"(1998 - 2008) Population censuses\") + \nxlab(\"Longitude\") + \nylab(\"Latitude\") + \ngeom_point(data=map.features, aes(x=long, y=lat, shape=Geolocation, size=Geolocation), color=\"black\") +\nscale_shape_manual(values=c(17, 16, 3)) +\nscale_size_manual(values=c(2,4,3)) + \ntheme(legend.key.height=unit(0.8, \"line\")) + \ntheme(legend.key.width=unit(0.8, \"line\"))\n```\n\n##### Load case dataset and subset by serovar\n```{r LoadCaseDS, results=\"hide\", message=FALSE, warning=FALSE}\ncase <-read.csv(curl(\"https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/case.csv\"))\ncase$case_date <- dmy(case$case_date)\ncase$case_count <- c(1)\ncase.typhi <- subset(case, organism==\"typhi\")\ncase.iNTS <- subset(case, organism==\"iNTS\")\n```\n\n##### Assign 0 when no case was diagnosed on that day\n```{r AssignCaseDS, results=\"hide\", message=FALSE, warning=FALSE}\ncase.typhi <-aggregate(case.typhi$case_count, by=list(case.typhi$case_date), FUN=sum, na.rm=TRUE)\nnames(case.typhi) <- c(\"date\", \"case_count\")\ncase.typhi <- merge(case.typhi, data.table(date=seq.Date(min(case$case_date), max(case$case_date), by=\"day\")), by=\"date\", all=TRUE)\ncase.typhi[is.na(case.typhi)]<-0\n\ncase.iNTS <-aggregate(case.iNTS$case_count, by=list(case.iNTS$case_date), FUN=sum, na.rm=TRUE)\nnames(case.iNTS) <- c(\"date\", \"case_count\")\ncase.iNTS <- merge(case.iNTS, data.table(date=seq.Date(min(case$case_date), max(case$case_date), by=\"day\")), by=\"date\", all=TRUE)\ncase.iNTS[is.na(case.iNTS)]<-0\n```\n\n##### Convert to XTS and aggregate monthly\n```{r ConvertCaseTXS, results=\"hide\", message=FALSE, warning=FALSE}\ncase.typhi = as.xts(case.typhi[,-1,drop=FALSE], order.by=as.Date(case.typhi[,1]))\ncase.iNTS = as.xts(case.iNTS[,-1,drop=FALSE], order.by=as.Date(case.iNTS[,1]))\ncase.typhi <- apply.monthly(case.typhi, FUN=sum)\ncase.iNTS <- apply.monthly(case.iNTS, FUN=sum)\n```\n\n##### Load Blantyre climate dataset\n```{r LoadClimateDS, results=\"hide\", message=FALSE, warning=FALSE}\nclimate <- read.csv(curl(\"https://raw.githubusercontent.com/deusthindwa/dlnm.typhoid.nts.climate.blantyre.malawi/master/data/climate.csv\"))\n```\n\n##### Define average rain/temp between chileka & chichiri stations\n```{r DefineRT, results=\"hide\", message=FALSE, warning=FALSE}\nclimate$climate_date <- dmy(climate$date)\nclimate$rainfall <- (climate$chil_r+climate$chic_r)/2 \nclimate$temperature <- ((climate$chil_mint+climate$chil_maxt)/2+(climate$chic_mint+climate$chic_maxt)/2)/2\nclimate <- subset(climate, select=c(climate_date, rainfall, temperature))\nclimate.rain <- subset(climate, select=c(climate_date, rainfall))\nclimate.temp <- subset(climate, select=c(climate_date, temperature))\n```\n\n##### Convert to XTS and aggregate monthly\n```{r ConvertClimateTXS, results=\"hide\", message=FALSE, warning=FALSE}\nclimate.rain <- as.xts(climate.rain[,-1, drop=FALSE], order.by=as.Date(climate.rain[,1]))\nclimate.temp <- as.xts(climate.temp[,-1, drop=FALSE], order.by=as.Date(climate.temp[,1]))\nclimate.rain <- apply.monthly(climate.rain, FUN=mean)\nclimate.temp <- apply.monthly(climate.temp, FUN=mean)\n```\n\n##### Create datasets for time series decomposition\n```{r CreateTibbles, results=\"hide\", message=FALSE, warning=FALSE}\ncase.typhi <- tk_tbl(case.typhi, preserve_index=TRUE, rename_index=\"date\") \ncase.iNTS <- tk_tbl(case.iNTS, preserve_index=TRUE, rename_index=\"date\") \nclimate.rain <- tk_tbl(climate.rain, preserve_index=TRUE, rename_index=\"date\") \nclimate.temp <- tk_tbl(climate.temp, preserve_index=TRUE, rename_index=\"date\") \n```\n\n##### Seasonal-adjusted NTS cases\n```{r SeasonalAdjNTS, results=\"hide\", message=FALSE, warning=FALSE}\ncase.iNTS.ts <- ts(na.omit(case.iNTS$case_count), frequency=12)\ntrend_n <- tk_tbl(exp(seasadj(mstl(log(case.iNTS.ts)))), preserve_index=FALSE)\ncase.iNTS$case_count_sea <- trend_n$value \ncase.iNTS$case_count_sea[case.iNTS$case_count_sea < 0] <- 0\nsetnames(case.iNTS, old=\"case_count\", new=\"case_count_obs\")\ntrend_n <-tk_tbl(exp(mstl(log(case.iNTS.ts))))\ncase.iNTS$case_count_tre <- trend_n$Trend\n```\n\n##### Seasonal-adjusted typhoid cases\n```{r SeasonalAdjTYP, results=\"hide\", message=FALSE, warning=FALSE}\ncase.typhi.ts <- ts(na.omit(case.typhi$case_count), frequency=12)\ntrend_n <- tk_tbl(exp(seasadj(mstl(log(case.typhi.ts+1)))), preserve_index=FALSE)\ncase.typhi$case_count_sea <-trend_n$value\ncase.typhi$case_count_sea[case.typhi$case_count_sea < 0] <- 0\nsetnames(case.typhi, old=\"case_count\", new=\"case_count_obs\")\ntrend_n <- tk_tbl(exp(mstl(log(case.typhi.ts+1))))\ncase.typhi$case_count_tre <- trend_n$Trend\n```\n\n##### Seasonal-adjusted rainfall\n```{r SeasonalAdjRain, results=\"hide\", message=FALSE, warning=FALSE}\nclimate.rain.ts <- ts(na.omit(climate.rain$rainfall), frequency=12)\ntrend_n <- tk_tbl(seasadj(mstl(climate.rain.ts)), preserve_index=FALSE)\nclimate.rain$rainfall_sea <- trend_n$value\nclimate.rain$rainfall_sea[climate.rain$rainfall_sea < 0] <- 0\nsetnames(climate.rain, old=\"rainfall\", new=\"rainfall_obs\")\ntrend_n <-tk_tbl(mstl(climate.rain.ts))\nclimate.rain$rain_tre <- trend_n$Trend\n```\n\n##### Seasonal-adjusted temperature\n```{r SeasonalAdjTemp, results=\"hide\", message=FALSE, warning=FALSE}\nclimate.temp.ts <- ts(na.omit(climate.temp$temperature), frequency=12)\ntrend_n <-tk_tbl(seasadj(mstl(climate.temp.ts)), preserve_index=FALSE)\nclimate.temp$temperature_sea <- trend_n$value\nclimate.temp$temperature_sea[climate.temp$temperature_sea < 0] <- 0\nsetnames(climate.temp, old=\"temperature\", new=\"temperature_obs\")\ntrend_n <- tk_tbl(mstl(climate.temp.ts))\nclimate.temp$temp_tre <- trend_n$Trend\n\nrm(list=ls()[grep(\"^trend_n\", ls())])\n```\n\n##### Plots of decomposed series (Supplementary Figure 1)\n```{r DecomposedTS, results=\"hide\", message=FALSE, warning=FALSE, fig.width=10, fig.height=5, fig.align='center'}\nx<-case.iNTS.ts %>% mstl() %>% ggfortify:::autoplot.ts(main=\"A\",xlab=\"Years (2000-2015)\",size=1,colour=\"orange2\",is.date=FALSE)+theme_bw()\ny<-case.typhi.ts %>% mstl() %>% ggfortify:::autoplot.ts(main=\"B\",xlab=\"Years (2000-2015)\",size=1,colour=\"red2\",is.date=FALSE)+theme_bw()\nz<-climate.rain.ts %>% mstl() %>% ggfortify:::autoplot.ts(main=\"C\",xlab=\"Years (2000-2015)\",size=1,colour=\"blue2\",is.date=FALSE)+theme_bw()\nv<-climate.temp.ts %>% mstl() %>% ggfortify:::autoplot.ts(main=\"D\",xlab=\"Years (2000-2015)\",size=1,colour=\"green2\",is.date=FALSE)+theme_bw()\ngrid.arrange(grobs=list(x,y,z,v), ncol=4, nrow=1)\n```\n\n##### Plots of seasonal-adjusted incidences (Supplementary Figure 2)\n```{r SeasonAdjTS, results=\"hide\", message=FALSE, warning=FALSE, fig.width=9, fig.height=5, fig.align='center'}\nTh <- theme(plot.title=element_text(hjust=0)) + \ntheme(axis.title.x=element_text(size=10)) + \ntheme(axis.title.y=element_text(size=10)) +\ntheme(axis.text.x=element_text(face=\"bold\", size=10), axis.text.y=element_text(face=\"bold\", size=10)) + \ntheme(legend.key.height=unit(1, \"line\")) + \ntheme(legend.key.width=unit(1, \"line\")) \n\nS1 <- ggplot(as.data.frame(case.iNTS)) + \ngeom_line(aes(date, case_count_obs, color=\"Original\"), size=0.8) + \ngeom_line(aes(date, case_count_sea, color=\"Seasonal-adjusted\"), size=0.8) + \nscale_color_manual(values = c(\"Original\"=\"black\",\"Seasonal-adjusted\"=\"orange2\")) +\nlabs(title=\"A\", x=\"\", y=\"NTS cases\") + theme(plot.title=element_text(hjust=0)) +\ntheme(legend.justification=c(0.5,0), legend.position=c(0.7,0.7), legend.text=element_text(size=10), \nlegend.title=element_text(size=0))\n\nS2<-ggplot(as.data.frame(case.typhi)) + \ngeom_line(aes(date, case_count_obs, color=\"Original\"), size=0.8) + \ngeom_line(aes(date, case_count_sea, color=\"Seasonal-adjusted\"), size=0.8) + \nscale_color_manual(values = c(\"Original\"=\"black\",\"Seasonal-adjusted\"=\"red2\")) +\nlabs(title=\"B\", x =\"\", y=\"Typhoid cases\") + Th +\ntheme(legend.justification=c(0.5,0), legend.position = c(0.3,0.7), legend.text = element_text(size = 10), \nlegend.title = element_text(size=0))\n\nS3<-ggplot(as.data.frame(climate.rain)) + \ngeom_line(aes(date, rainfall_obs, color=\"Original\"), size=0.8) + \ngeom_line(aes(date, rainfall_sea, color=\"Seasonal-adjusted\"), size=0.8) + \nscale_color_manual(values = c(\"Original\"=\"black\",\"Seasonal-adjusted\"=\"blue2\")) +\nlabs(title=\"C\", x =\"Year\", y = \"Rainfall (mm)\") + Th + \ntheme(legend.justification=c(0.5,0), legend.position = c(0.3,0.7), legend.text = element_text(size = 10), \nlegend.title = element_text(size=0))\n\nS4<-ggplot(as.data.frame(climate.temp)) + \ngeom_line(aes(date, temperature_obs, color=\"Original\"), size=0.8) + \ngeom_line(aes(date, temperature_sea, color=\"Seasonal-adjusted\"), size=0.8) + \nscale_color_manual(values = c(\"Original\"=\"black\",\"Seasonal-adjusted\"=\"green2\")) + \nlabs(title=\"D\", x =\"Year\", y = \"Temperature (°C)\") + Th + \ntheme(legend.justification=c(0.5,0), legend.position = c(0.3,0.7), legend.text = element_text(size = 10), \nlegend.title = element_text(size=0))\n\ngrid.arrange(grobs=list(S1, S2, S3, S4), ncol=2, nrow=2)\n```\n\n##### Inter/extraporate population denominators\n```{r InterExtraPoration, results=\"hide\", message=FALSE, warning=FALSE}\ncensus.year <-c(1998, 2008)\ncensus.popn <-c(809397, 1022680)\ncensus.count.1998.2008 <-approx(census.year, census.popn, n=11) \ncensus.count.2009.2015 <-approxExtrap(census.year, census.popn, xout=c(2009, 2010, 2011, 2012, 2013, 2014, 2015))\n```\n\n##### Calculate NTS/typhoid incidence rates\n```{r CaseIncidence, results=\"hide\", message=FALSE, warning=FALSE}\ncase.iNTS$census[year(case.iNTS$date)==2000]<-852054; case.iNTS$census[year(case.iNTS$date)==2001]<-873382\ncase.iNTS$census[year(case.iNTS$date)==2002]<-894710; case.iNTS$census[year(case.iNTS$date)==2003]<-916039\ncase.iNTS$census[year(case.iNTS$date)==2004]<-937367; case.iNTS$census[year(case.iNTS$date)==2005]<-958695\ncase.iNTS$census[year(case.iNTS$date)==2006]<-980023; case.iNTS$census[year(case.iNTS$date)==2007]<-1001352\ncase.iNTS$census[year(case.iNTS$date)==2008]<-1022680; case.iNTS$census[year(case.iNTS$date)==2009]<-1044008\ncase.iNTS$census[year(case.iNTS$date)==2010]<-1065337; case.iNTS$census[year(case.iNTS$date)==2011]<-1086665\ncase.iNTS$census[year(case.iNTS$date)==2012]<-1107993; case.iNTS$census[year(case.iNTS$date)==2013]<-1129322\ncase.iNTS$census[year(case.iNTS$date)==2014]<-1150650; case.iNTS$census[year(case.iNTS$date)==2015]<-1171978\ncase.iNTS$incid_sea <-case.iNTS$case_count_sea*100000/case.iNTS$census \ncase.iNTS$incid_obs <-case.iNTS$case_count_obs*100000/case.iNTS$census \n\ncase.typhi$census[year(case.typhi$date)==2000]<-852054; case.typhi$census[year(case.typhi$date)==2001]<-873382\ncase.typhi$census[year(case.typhi$date)==2002]<-894710; case.typhi$census[year(case.typhi$date)==2003]<-916039\ncase.typhi$census[year(case.typhi$date)==2004]<-937367; case.typhi$census[year(case.typhi$date)==2005]<-958695\ncase.typhi$census[year(case.typhi$date)==2006]<-980023; case.typhi$census[year(case.typhi$date)==2007]<-1001352\ncase.typhi$census[year(case.typhi$date)==2008]<-1022680; case.typhi$census[year(case.typhi$date)==2009]<-1044008\ncase.typhi$census[year(case.typhi$date)==2010]<-1065337; case.typhi$census[year(case.typhi$date)==2011]<-1086665\ncase.typhi$census[year(case.typhi$date)==2012]<-1107993; case.typhi$census[year(case.typhi$date)==2013]<-1129322\ncase.typhi$census[year(case.typhi$date)==2014]<-1150650; case.typhi$census[year(case.typhi$date)==2015]<-1171978\ncase.typhi$incid_sea <-case.typhi$case_count_sea*100000/case.typhi$census \ncase.typhi$incid_obs <-case.typhi$case_count_obs*100000/case.typhi$census  \n```\n\n##### Plots of trends in NTS, typhoid, rain and temperature (Supplementary Figure 3)\n```{r CaseTrends, results=\"hide\", message=FALSE, warning=FALSE, fig.width=10, fig.height=6, fig.align='center'}\nE1<-ggplot() + \ngeom_line(data=case.iNTS, aes(x=date, y=case_count_tre, color=\"Number of NTS cases\"), stat=\"identity\", size=1.0) + \ngeom_line(data=climate.rain, aes(x=date, y=rain_tre/0.04, color=\"Rainfall\"), alpha=0.8, size=0.7) + \nscale_y_continuous(sec.axis = sec_axis(~.*0.04, name=\"(mm)\")) + theme_bw() +\nscale_color_manual(values = c(\"Number of NTS cases\"=\"orange2\", \"Rainfall\"=\"blue2\")) + \nggtitle(\"A\") + ylab(\"Cases\") + xlab(\"Month'Year\") + \ntheme(axis.title.x = element_text(size=0), axis.title.y=element_text(size=10, color=\"orange2\",face=\"bold\"), \nplot.title = element_text(hjust=0,face=\"bold\")) +\ntheme(axis.text.x=element_text(size=0), axis.title.y.right=element_text(color=\"blue2\", size=10), \naxis.text.y = element_text(face=\"bold\", size=10)) + \nscale_x_date(date_breaks = \"24 month\", date_labels =\"%b'%y\") +\ntheme(legend.justification=c(0.5,0), legend.position=c(0.6,0.7), legend.text=element_text(size=10), \nlegend.title=element_text(size=0)) + theme(legend.key.height=unit(1,\"line\")) + theme(legend.key.width=unit(1,\"line\"))\n\nE2<-ggplot() + \ngeom_line(data=case.iNTS, aes(x=date, y=case_count_tre, color=\"Number of NTS cases\"), stat=\"identity\", size=1.0) + \ngeom_line(data=climate.temp, aes(x=date, y=temp_tre/0.4, color=\"Temperature\"), alpha=0.8, size=0.7) + \nscale_y_continuous(sec.axis = sec_axis(~.*0.4, name=\"(°C)\")) + theme_bw() +\nscale_color_manual(values=c(\"Number of NTS cases\"=\"orange2\", \"Temperature\"=\"green2\")) + \nggtitle(\"B\") + ylab(\"Cases\") + xlab(\"Month'Year\") + \ntheme(axis.title.x = element_text(size=10), axis.title.y=element_text(size=10, color=\"orange2\",face=\"bold\"), \nplot.title = element_text(hjust=0,face=\"bold\")) +\ntheme(axis.text.x=element_text(size=8), axis.title.y.right=element_text(color=\"green2\", size=10), \naxis.text.y=element_text(face=\"bold\", size=10)) + \nscale_x_date(date_breaks = \"24 month\", date_labels =\"%b'%y\") +\ntheme(legend.justification=c(0.5,0), legend.position=c(0.6,0.6), legend.text = element_text(size=10), \nlegend.title=element_text(size=0)) + theme(legend.key.height=unit(1,\"line\")) + theme(legend.key.width=unit(1,\"line\"))\n\nE3<-ggplot() + \ngeom_line(data=case.typhi, aes(x=date, y=case_count_tre, color=\"Number of typhoid cases\"), stat=\"identity\", size=1.0) + \ngeom_line(data=climate.rain, aes(x=date, y=rain_tre/0.06, color=\"Rainfall\"), alpha=0.8, size=0.7) + \nscale_y_continuous(sec.axis=sec_axis(~.*0.06, name=\"(mm)\")) + theme_bw() +\nscale_color_manual(values=c(\"Number of typhoid cases\"=\"red2\", \"Rainfall\"=\"blue2\")) + \nggtitle(\"C\") + ylab(\"Cases\") + xlab(\"Month'Year\") + \ntheme(axis.title.x = element_text(size=0), axis.title.y=element_text(size=10, color=\"red2\",face=\"bold\"),\nplot.title=element_text(hjust=0,face=\"bold\")) +\ntheme(axis.text.x=element_text(size=0), axis.title.y.right=element_text(color=\"blue2\", size=10),\naxis.text.y = element_text(face=\"bold\", size=10)) + \nscale_x_date(date_breaks = \"24 month\", date_labels =\"%b'%y\") +\ntheme(legend.justification=c(0.5,0), legend.position=c(0.35,0.09), legend.text=element_text(size=10), \nlegend.title = element_text(size=0)) + theme(legend.key.height=unit(1,\"line\")) + theme(legend.key.width=unit(1,\"line\"))\n\nE4<-ggplot() + \ngeom_line(data=case.typhi, aes(x=date, y=case_count_tre, color=\"Number of typhoid cases\"), stat=\"identity\", size=1.0) + \ngeom_line(data=climate.temp, aes(x=date, y=temp_tre/0.6, color=\"Temperature\"), alpha=0.8, size = 0.7) + \nscale_y_continuous(sec.axis=sec_axis(~.*0.6, name=\"(°C)\")) + theme_bw() +\nscale_color_manual(values=c(\"Number of typhoid cases\"=\"red2\", \"Temperature\"=\"green2\")) + \nggtitle(\"D\") + ylab(\"Cases\") + xlab(\"Month'Year\") + \ntheme(axis.title.x=element_text(size=10), axis.title.y=element_text(size=10, color=\"red2\",face=\"bold\"), \nplot.title=element_text(hjust=0,face=\"bold\")) +\ntheme(axis.text.x=element_text(face=\"bold\", size=8), axis.title.y.right = element_text(color=\"green2\", size=10),\naxis.text.y = element_text(face=\"bold\", size=10)) + \nscale_x_date(date_breaks=\"24 month\", date_labels=\"%b'%y\") +\ntheme(legend.justification=c(0.5,0), legend.position=c(0.35,0.09), legend.text=element_text(size=10), \nlegend.title = element_text(size=0)) + theme(legend.key.height=unit(1,\"line\")) + theme(legend.key.width=unit(1,\"line\"))\n\ngrid.arrange(grobs=list(E1, E3, E2, E4), ncol=2, nrow=2)\n```\n\n##### Plots of Age-sex distribution of cases (Figure 3)\n```{r AgeDistr, results=\"hide\", message=FALSE, warning=FALSE, fig.width=10, fig.height=4, fig.align='center'}\ncase$sex[case$sex == \"\"] <- NA\ncase$age[case$age == \"\"] <- NA\ncase$date <- ymd(case$case_date)\ncase$year <- year(case$date)\n\nagesex.p1 <- ggplot(subset(case, organism==\"iNTS\" & !is.na(age) & sex != \"Unknown\"), aes(x=age, color=sex)) + \ngeom_freqpoly(position=position_dodge(width=1.5), binwidth=1, size=1) + \nscale_color_manual(values=c(Male=\"gray40\",Female=\"red3\")) + \ntheme_bw() + \nscale_x_continuous(limits=c(0, 91), breaks=seq(0, 91, 5)) + \nlabs(title=\"A\", x=\"Age (years)\", y=\"Number of NTS cases\") + \ntheme(plot.title=element_text(hjust=0,face=\"bold\")) +\ntheme(axis.text.x=element_text(face=\"bold\", size=10, color=\"black\"), axis.text.y=element_text(face=\"bold\", size=10, color=\"black\")) + \ntheme(legend.justification=c(0.5,0), legend.position=c(0.5, 0.6), legend.text=element_text(size=10), legend.title=element_text(size=10)) + \nlabs(color=\"Missing sex: 2,596 (32.3%)\") + \ntheme(legend.key.height=unit(1,\"line\")) + \ntheme(legend.key.width=unit(1,\"line\"))\n\nagesex.p2<- ggplot(subset(case, organism==\"typhi\" & !is.na(age) & sex !=\"Unknown\"), aes(x=age, color=sex)) + \ngeom_freqpoly(position=position_dodge(width=1.5), binwidth=1, size=1) + \nscale_color_manual(values=c(Male=\"gray40\",Female=\"red3\")) + \ntheme_bw() + \nscale_x_continuous(limits=c(0, 91), breaks=seq(0, 91, 5)) + \nlabs(title=\"B\", x=\"Age (years)\", y=\"Number of typhoid cases\") + \ntheme(plot.title = element_text(hjust=0,face=\"bold\")) +\ntheme(axis.text.x=element_text(face=\"bold\", size=10, color=\"black\"), axis.text.y=element_text(face=\"bold\", size=10, color=\"black\")) + \ntheme(legend.justification=c(0.5,0), legend.position=c(0.5, 0.6), legend.text=element_text(size=10), legend.title=element_text(size=10)) + \nlabs(color=\"Missing sex: 61 (2.4%)\") + \ntheme(legend.key.height=unit(1,\"line\")) + \ntheme(legend.key.width=unit(1,\"line\"))\n\ngrid.arrange(grobs=list(agesex.p1, agesex.p2), ncol=2, nrow=1)\n```\n\n##### Generating yearly and monthly dynamics\n```{r NTS2000.2010}\ncase.iNTS.spi <- subset(case.iNTS, year(case.iNTS$date)<2011, select=c(date,incid_sea)) \ncase.iNTS.spi$month <-month(case.iNTS.spi$date)\ncase.iNTS.spi$year <- year(case.iNTS.spi$date); case.iNTS.spi$date <- NULL\ncase.iNTS.spi <- spread(case.iNTS.spi, year, incid_sea); case.iNTS.spi <- as.matrix(case.iNTS.spi)[,-1]\nYMD1 <- plot_ly(x=c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010), y=c(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"), \nz=~case.iNTS.spi, type=\"contour\", colorscale='jet', contours=list(showlabels=TRUE)) %>% \ncolorbar(title=\"NTS incidence per \\n 100,000 population\") %>%\nlayout(title=\"A\", xaxis=list(title=\"Year\"), yaxis=list(title=\"Month\"), font=list(size=13))\n```\n\n```{r TYP2011.2015}\ncase.typhi.spi <- subset(case.typhi, year(case.typhi$date)>2010, select=c(date,incid_sea)) \ncase.typhi.spi$month <- month(case.typhi.spi$date)\ncase.typhi.spi$year <- year(case.typhi.spi$date); case.typhi.spi$date <- NULL\ncase.typhi.spi <- spread(case.typhi.spi, year, incid_sea); case.typhi.spi <- as.matrix(case.typhi.spi)[,-1]\nYMD2 <- plot_ly(x = c(2011,2012,2013,2014,2015), y=c(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"), \nz=~case.typhi.spi, type=\"contour\", colorscale='heatmap', contours=list(showlabels=TRUE)) %>% \ncolorbar(title=\"Typhoid incidence per \\n 100,000 population\") %>%\nlayout(title=\"D\", xaxis=list(title=\"Year\"), yaxis=list(title=\"Month\"), font=list(size=13))\n```\n\n```{r Rain2000.2010}\nclimate.rain.spin <- subset(climate.rain, year(climate.rain$date)<2011, select=c(date,rainfall_obs)) \nclimate.rain.spin$month <- month(climate.rain.spin$date)\nclimate.rain.spin$year <- year(climate.rain.spin$date); climate.rain.spin$date <- NULL\nclimate.rain.spin <- spread(climate.rain.spin, year, rainfall_obs); climate.rain.spin <- as.matrix(climate.rain.spin)[,-1]\nYMD3 <- plot_ly(x = c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010), y=c(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"), \nz=~climate.rain.spin, type=\"contour\", colorscale='heatmap', contours=list(showlabels=TRUE)) %>% colorbar(title=\"Rainfall (mm)\") %>% \nlayout(title=\"B\", xaxis=list(title=\"Year\"), yaxis=list(title=\"Month\"), font=list(size=13))\n```\n\n```{r Rain2011.2015}\nclimate.rain.spit <- subset(climate.rain, year(climate.rain$date)>2010, select=c(date,rainfall_obs)) \nclimate.rain.spit$month <- month(climate.rain.spit$date)\nclimate.rain.spit$year <- year(climate.rain.spit$date); climate.rain.spit$date <- NULL\nclimate.rain.spit <- spread(climate.rain.spit, year, rainfall_obs); climate.rain.spit <- as.matrix(climate.rain.spit)[,-1]\nYMD4 <- plot_ly(x = c(2011,2012,2013,2014,2015), y=c(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"), \nz=~climate.rain.spit, type=\"contour\", colorscale='heatmap', contours=list(showlabels=TRUE)) %>% \ncolorbar(title=\"Rainfall (mm)\") %>%\nlayout(title=\"E\", xaxis=list(title=\"Year\"), yaxis=list(title=\"Month\"), font=list(size=13))\n```\n\n```{r Temp2000.2010}\nclimate.temp.spin <- subset(climate.temp, year(climate.temp$date)<2011, select=c(date,temperature_obs)) \nclimate.temp.spin$month <- month(climate.temp.spin$date)\nclimate.temp.spin$year <- year(climate.temp.spin$date); climate.temp.spin$date <- NULL\nclimate.temp.spin <- spread(climate.temp.spin, year, temperature_obs); climate.temp.spin <- as.matrix(climate.temp.spin)[,-1]\nYMD5 <- plot_ly(x=c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010), y=c(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"), \nz=~climate.temp.spin, type=\"contour\", colorscale='heatmap', contours=list(showlabels=TRUE)) %>% \ncolorbar(title=\"Temperature (°C)\") %>%\nlayout(title=\"C\", xaxis=list(title=\"Year\"), yaxis=list(title=\"Month\"), font=list(size=13))\n```\n\n```{r Temp2011.2015}\nclimate.temp.spit <- subset(climate.temp, year(climate.temp$date)>2010, select=c(date,temperature_obs)) \nclimate.temp.spit$month <- month(climate.temp.spit$date)\nclimate.temp.spit$year <- year(climate.temp.spit$date); climate.temp.spit$date <- NULL\nclimate.temp.spit <- spread(climate.temp.spit, year, temperature_obs); climate.temp.spit <- as.matrix(climate.temp.spit)[,-1]\nYMD6 <- plot_ly(x=c(2011,2012,2013,2014,2015), y=c(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"), \nz=~climate.temp.spit, type=\"contour\", colorscale='heatmap', contours=list(showlabels=TRUE)) %>%\ncolorbar(title=\"Temperature (°C)\") %>%\nlayout(title=\"F\", xaxis=list(title=\"Year\"), yaxis=list(title=\"Month\"), font=list(size = 13))\n```\n\n##### Plots of yearly and monthly dynamics (Figure 2)\n```{r message=FALSE, warning=FALSE, paged.print=FALSE, fig.align='center', fig.height=5, fig.width=15}\nhtmltools::tags$div(\nstyle = \"display: flex; flex-wrap: wrap\",\ntags$div(YMD1, style = \"width: 33%;\"),\ntags$div(YMD3, style = \"width: 33%;\"),\ntags$div(YMD5, style = \"width: 33%;\"),\ntags$div(YMD2, style = \"width: 33%;\"),\ntags$div(YMD4, style = \"width: 33%;\"),\ntags$div(YMD6, style = \"width: 33%;\")\n)\n```\n\n##### Constructing DLNM datasets for NTS and Typhoid\n```{r NTS.TYP.dlnmDS, results=\"hide\", message=FALSE, warning=FALSE}\nmo.dlnmN <- bind_cols(case.iNTS, climate.rain, climate.temp, id=NULL)\nmo.dlnmN$date1 <- mo.dlnmN$date2 <- NULL\nmo.dlnmN <- subset(mo.dlnmN, year(date) < 2011)\nmo.dlnmN$time <- seq.int(from = 1, to=132, by=1)\nmo.dlnmN$year <- year(mo.dlnmN$date)\nmo.dlnmN$month <- month(mo.dlnmN$date)\nmo.dlnmN$incid_seaX<-round(mo.dlnmN$incid_sea, digits = 0)\nmo.dlnmN$incid_obsX<-round(mo.dlnmN$incid_obs, digits = 0)\n\nmo.dlnmT <- bind_cols(case.typhi, climate.rain, climate.temp, id=NULL)\nmo.dlnmT$date1 <- mo.dlnmT$date2 <- NULL\nmo.dlnmT <- subset(mo.dlnmT, year(date) > 2010)\nmo.dlnmT$time <- seq.int(from = 1, to=60, by=1)\nmo.dlnmT$year <- year(mo.dlnmT$date)\nmo.dlnmT$month <- month(mo.dlnmT$date)\nmo.dlnmT$incid_seaX<-round(mo.dlnmT$incid_sea, digits = 0)\n```\n\n##### Switching from AIC to QAIC for NTS and Typhoid\n```{r AIC.AIC, results=\"hide\", message=FALSE, warning=FALSE}\nnts.quasipoisson <- function(...) { \n  res <- quasipoisson(...)\n  res$aic <- poisson(...)$aic \n  res\n}\ntyp.quasipoisson <- function(...) { \n  res <- quasipoisson(...) \n  res$aic <- poisson(...)$aic \n  res\n}\n```\n\n##### Calculate QAIC values to select optimal models (Supplementary Table)\n```{r QAICs, message=FALSE, warning=FALSE, fig.width=10, fig.align='center'}\nQAICtable <- data.frame(model.no=rep(NA,27), lag.df=rep(NA,27), fx1.df=rep(NA,27), fx2.df=rep(NA,27), \n                    QAIC.ntsR=rep(NA,27), QAIC.ntsT=rep(NA,27), QAIC.nts=rep(NA,27), QAIC.typR=rep(NA,27), \n                    QAIC.typT=rep(NA,27), QAIC.typ=rep(NA,27))\nl=1\nfor(k in 3:5){\nfor(j in 3:5){\n  for(i in 3:5){\nnts.lagknots <- logknots(8, fun=\"ns\", df=i)\nnts.varknots.r=equalknots(mo.dlnmN$rainfall_obs, fun=\"ns\", df=j)\nnts.varknots.t=equalknots(mo.dlnmN$temperature_obs, fun=\"ns\", df=k)\nnts.mo.cb.rain <- crossbasis(mo.dlnmN$rainfall_obs, lag=8, argvar=list(fun=\"ns\", knots=nts.varknots.r), arglag=list(knots=nts.lagknots))\nnts.mo.cb.temp <- crossbasis(mo.dlnmN$temperature_obs, lag=8, argvar=list(fun=\"ns\", knots=nts.varknots.t), arglag=list(knots=nts.lagknots))\nnts.modelR <- glm(mo.dlnmN$incid_seaX ~ nts.mo.cb.rain + year, family=nts.quasipoisson(), na.action=na.delete, mo.dlnmN)\nnts.modelT <- glm(mo.dlnmN$incid_seaX ~ nts.mo.cb.temp + year, family=nts.quasipoisson(), na.action=na.delete, mo.dlnmN)\nnts.model <-  glm(mo.dlnmN$incid_seaX ~ nts.mo.cb.rain + nts.mo.cb.temp + year, family = nts.quasipoisson(), na.action=na.delete, mo.dlnmN)\n\ntyp.lagknots <- logknots(8, fun=\"ns\", df=i)\ntyp.varknots.r=equalknots(mo.dlnmT$rainfall_obs, fun=\"ns\", df=j)\ntyp.varknots.t=equalknots(mo.dlnmT$temperature_obs, fun=\"ns\", df=k)\ntyp.mo.cb.rain <- crossbasis(mo.dlnmT$rainfall_obs, lag=8, argvar=list(fun=\"ns\", knots=typ.varknots.r), arglag=list(knots=typ.lagknots))\ntyp.mo.cb.temp <- crossbasis(mo.dlnmT$temperature_obs, lag =8, argvar = list(fun=\"ns\", knots=typ.varknots.t), arglag=list(knots=typ.lagknots))\ntyp.modelR <- glm(mo.dlnmT$incid_seaX ~ typ.mo.cb.rain + year, family = typ.quasipoisson(), na.action=na.delete, mo.dlnmT)\ntyp.modelT <- glm(mo.dlnmT$incid_seaX ~ typ.mo.cb.temp + year, family = typ.quasipoisson(), na.action=na.delete, mo.dlnmT)\ntyp.model <- glm(mo.dlnmT$incid_seaX ~ typ.mo.cb.rain + typ.mo.cb.temp + year, family = typ.quasipoisson(), na.action=na.delete, mo.dlnmT)\n\nQAICtable[l,] <- c(l,i,j,k, QAIC(nts.modelR, chat=summary(nts.modelR)$dispersion), QAIC(nts.modelT, chat=summary(nts.modelT)$dispersion), \n                   QAIC(nts.model, chat=summary(nts.model)$dispersion), QAIC(typ.modelR, chat=summary(typ.modelR)$dispersion), QAIC(typ.modelT, chat=summary(typ.modelT)$dispersion), \n                   QAIC(typ.model, chat=1))\nl=l+1  \n  }\n}\n  }\nkable(QAICtable)\n```\n\n##### Reformulate cross-basis matrix using selected best NTS model\n```{r cross.basisNTS, results=\"hide\", message=FALSE, warning=FALSE}\nsort(mo.dlnmN$rainfall_obs, decreasing=FALSE)\nsort(mo.dlnmN$temperature_obs, decreasing=FALSE)\nnts.lagknots.r <- logknots(8, fun=\"ns\", df=3)\nnts.varknots.r=equalknots(mo.dlnmN$rainfall_obs, fun=\"ns\", df=3)\nnts.lagknots.t <- logknots(8, fun=\"ns\", df=3)\nnts.varknots.t=equalknots(mo.dlnmN$temperature_obs, fun=\"ns\", df=3)\nnts.cb.rain <- crossbasis(mo.dlnmN$rainfall_obs, lag=8, argvar=list(fun=\"ns\", knots=nts.varknots.r), arglag=list(knots=nts.lagknots.r))\nnts.cb.temp <- crossbasis(mo.dlnmN$temperature_obs, lag=8, argvar=list(fun=\"ns\", knots=nts.varknots.t), arglag=list(knots=nts.lagknots.t))\nsummary(nts.cb.rain)\nsummary(nts.cb.temp)\n```\n\n##### Fit NTS model\n```{r FitNTS, results=\"hide\", message=FALSE, warning=FALSE}\nnts.model <- glm(mo.dlnmN$incid_seaX ~ nts.cb.rain + nts.cb.temp + year, family=quasipoisson(), na.action=na.delete, mo.dlnmN)\n```\n\n##### Investigate NTS deviance residuals\n```{r devianceNTS, results=\"hide\", message=FALSE, warning=FALSE, fig.width=9, fig.height=4, fig.align='center'}\npar(mfrow=c(1,2))\npacf(residuals(nts.model,type=\"deviance\"), na.action=na.omit, main=\"Original model with Rain & Temp\", xlim=c(0,8))\nnts.model <- update(nts.model,.~.+Lag(residuals(nts.model,type=\"deviance\"), 1)) #add residuals at lag 1 \npacf(residuals(nts.model,type=\"deviance\"), na.action=na.omit, main=\"Adjusted model with Rain & Temp\", xlim=c(0,8))\n```\n\n##### Run NTS predictions\n```{r predictrunNTS, results=\"hide\", message=FALSE, warning=FALSE}\nnts.pred.rain <- crosspred(nts.cb.rain, nts.model, cen=0, by=0.2)\nnts.pred.temp <- crosspred(nts.cb.temp, nts.model, cen=23, by=0.2)\n```\n\n```{r plotContourNTS, message=FALSE, warning=FALSE, include=FALSE, results=\"hide\"}\njpeg(\"nts.pred.rain.png\", width=900,height=600)\nplot(nts.pred.rain, \"contour\", key.title=title(\"NTS\"), plot.title=title(\"\", xlab =\"Rainfall (mm)\", ylab = \"Lag (month)\", cex.lab=1.7, cex.axis=1.7))\ndev.off()\njpeg(\"nts.pred.temp.png\", width=900,height=600)\nplot(nts.pred.temp, \"contour\", key.title=title(\"NTS\"), plot.title=title(\"\", xlab =\"Temperature (°C)\", ylab = \"Lag (month)\", cex.lab=1.7, cex.axis=1.7))\ndev.off()\nplot(load.image(\"nts.pred.rain.png\"), main=\"B\")\nplot(load.image(\"nts.pred.temp.png\"), main=\"B\")\n```\n\n##### Plots of NTS predictions due to rainfall (Figure 4)\n```{r predictRainNTS, results=\"hide\", message=FALSE, warning=FALSE, fig.align='center', fig.height=8, fig.width=12}\npar(mfrow=c(2,2))\nplot(nts.pred.rain, xlab=\"Rainfall (mm)\", ylab=\"Lag (month)\", zlab=\"RR of NTS\", theta=150, phi=5, lphi=100, cex.lab=1.1, cex.axis=1.1, col=\"gray80\",main=\"A\")\nplot(nts.pred.rain, \"slices\", xlab=\"Rainfall (mm) [given lag 2]\", lag=c(2), col=\"orange2\", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95, ci='b', lwd=4.5, ylab=\"RR of NTS\", cex.lab=1.1, cex.axis=1.1,main=\"B\")\nplot(nts.pred.rain, \"slices\", xlab=\"lag (month) [given 9 mm] \", var=c(9), col=\"orange2\", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95, ci='b', lwd=4.5, ylab=\"RR of NTS\", cex.lab=1.1, cex.axis=1.1,main=\"C\")\nplot(nts.pred.rain, \"slices\", xlab=\"lag (month) [given 13 mm] \", var=c(13), col=\"orange2\", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95, ci='b', lwd=4.5, ylab=\"RR of NTS\", cex.lab=1.1, cex.axis=1.1,main=\"D\")\n```\n\n##### Plots of NTS predictions due to temperature (Figure 6)\n```{r predictTempNTS, results=\"hide\", message=FALSE, warning=FALSE, fig.align='center', fig.height=8, fig.width=12}\npar(mfrow=c(2,2))\nplot(nts.pred.temp, xlab=\"Temperature (°C)\", ylab=\"Lag (month)\", zlab=\"RR of NTS\", theta=150, phi=5, lphi=100, cex.lab=1, cex.axis=1, col=\"gray80\",main=\"A\")\nplot(nts.pred.temp, xlab=\"Temperature (°C) [given lag 3]\", \"slices\",lag=c(3), col=\"orange2\", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95, ci='b',lwd=4.5, ylab=\"RR of NTS\", cex.lab=1.1, cex.axis=1.1,main=\"B\")\nplot(nts.pred.temp, xlab=\"Lag (month) [given 19 °C]\", \"slices\",var=c(19), col=\"orange2\", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95, ci='b',lwd=4.5, ylab=\"RR of NTS\", cex.lab=1.1, cex.axis=1.1,main=\"C\")\nplot(nts.pred.temp, xlab=\"Lag (month) [given 29 °C]\", \"slices\",var=c(29), col=\"orange2\", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95, ci='b',lwd=4.5, ylab=\"RR of NTS\", cex.lab=1.1, cex.axis=1.1,main=\"D\")\n```\n\n##### Reformulate cross-basis matrix using selected best Typhoid models\n```{r cross.basisTYP, results=\"hide\", message=FALSE, warning=FALSE}\nsort(mo.dlnmT$rainfall_obs, decreasing=FALSE)\nsort(mo.dlnmT$temperature_obs, decreasing=FALSE)\ntyp.lagknots <- logknots(8, fun=\"ns\", df=3)\ntyp.varknots.r1 <- equalknots(mo.dlnmT$rainfall_obs, fun=\"ns\", df=4)\ntyp.varknots.r2 <- equalknots(mo.dlnmT$rainfall_obs, fun=\"ns\", df=3)\ntyp.varknots.t <- equalknots(mo.dlnmT$temperature_obs, fun=\"ns\", df=3)\ntyp.cb.rain1 <- crossbasis(mo.dlnmT$rainfall_obs, lag=8, argvar=list(fun=\"ns\", knots=typ.varknots.r1), arglag=list(knots=typ.lagknots))\ntyp.cb.rain2 <- crossbasis(mo.dlnmT$rainfall_obs, lag=8, argvar=list(fun=\"ns\", knots=typ.varknots.r2), arglag=list(knots=typ.lagknots))\ntyp.cb.temp <- crossbasis(mo.dlnmT$temperature_obs, lag=8, argvar=list(fun=\"ns\", knots=typ.varknots.t), arglag=list(knots=typ.lagknots))\nsummary(typ.cb.rain1)\nsummary(typ.cb.rain2)\nsummary(typ.cb.temp)\n```\n\n##### Fit Typhoid models\n```{r FitTYP, results=\"hide\", message=FALSE, warning=FALSE}\ntyp.modelR <- glm(mo.dlnmT$incid_seaX ~ typ.cb.rain1 + year, family=quasipoisson(), na.action=na.delete, mo.dlnmT)\ntyp.modelT <- glm(mo.dlnmT$incid_seaX ~ typ.cb.temp + typ.cb.rain2 + year, family=quasipoisson(), na.action=na.delete, mo.dlnmT)\n```\n\n##### Investigate deviance residuals for fitted tyhpoid models\n```{r devianceTYP, results=\"hide\", message=FALSE, warning=FALSE, fig.width=8, fig.height=3, fig.align='center'}\npar(mfrow=c(1,3))\npacf(residuals(typ.modelR,type=\"deviance\"),na.action=na.omit,main=\"Original model with Rain\",xlim=c(0,8))\npacf(residuals(typ.modelT,type=\"deviance\"),na.action=na.omit,main=\"Original model with Rain & Temp\",xlim=c(0,8))\ntyp.modelT <- update(typ.modelT,.~.+Lag(residuals(typ.modelT,type=\"deviance\"),1)) #add residuals at lag 1\npacf(residuals(typ.modelT,type=\"deviance\"),na.action=na.omit,main=\"Adjusted model with Rain & Temp\",xlim=c(0,8))\n```\n\n##### Run typhoid predictions\n```{r predictrunTYP, results=\"hide\", message=FALSE, warning=FALSE}\ntyp.pred.rain <- crosspred(typ.cb.rain1, typ.modelR, cen=0, by=0.2)\ntyp.pred.temp <- crosspred(typ.cb.temp, typ.modelT, cen=23, by=0.2)\n```\n\n```{r plotContourTYP, message=FALSE, warning=FALSE, include=FALSE, results=\"hide\"}\njpeg(\"typ.pred.rain.png\", width=900,height=600)\nplot(typ.pred.rain, \"contour\", key.title=title(\"TYP\"), plot.title=title(\"\", xlab =\"Rainfall (mm)\", ylab = \"Lag (month)\", cex.lab=1.7, cex.axis=1.7))\ndev.off()\njpeg(\"typ.pred.temp.png\", width=900,height=600)\nplot(typ.pred.temp, \"contour\", key.title=title(\"TYP\"), plot.title=title(\"\", xlab =\"Temperature (°C)\", ylab = \"Lag (month)\", cex.lab=1.7, cex.axis=1.7))\ndev.off()\nplot(load.image(\"typ.pred.rain.png\"), main=\"B\")\nplot(load.image(\"typ.pred.temp.png\"), main=\"B\")\n```\n\n##### Plots of TYP predictions due to rainfall (Figure 5)\n```{r predictRainTYP, results=\"hide\", message=FALSE, warning=FALSE, fig.align='center', fig.height=8, fig.width=12}\npar(mfrow=c(2,2))\nplot(typ.pred.rain, xlab=\"Rainfall (mm)\", ylab=\"Lag (month)\", zlab=\"RR of typhoid\", theta=210, phi=10, lphi=150, col=\"gray80\", main=\"A\", cex.lab=1.1, cex.axis=1.1)\nplot(typ.pred.rain, xlab=\"Rainfall (mm) [given lag 4]\", \"slices\", lag=c(4), col=\"red2\", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab=\"RR of typhoid\", cex.lab=1.1, cex.axis=1.1,main=\"B\")\nplot(typ.pred.rain, xlab=\"Lag (month) [given 9 mm]\", \"slices\", var=c(9), col=\"red2\", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab=\"RR of typhoid\", cex.lab=1.1, cex.axis=1.1,main=\"C\")\nplot(typ.pred.rain, xlab=\"Lag (month) [given 16 mm]\", \"slices\", var=c(16), col=\"red2\", ci.arg=list(col=topo.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab=\"RR of typhoid\", cex.lab=1.1, cex.axis=1.1,main=\"D\")\n```\n\n##### Plots of TYP predictions due to temperature (Figure 7)\n```{r predictTempTYP, results=\"hide\", message=FALSE, warning=FALSE, fig.align='center', fig.height=8, fig.width=12}\npar(mfrow=c(2,3))\nplot(typ.pred.temp, xlab=\"Temperature (°C)\", ylab=\"Lag (month)\", zlab=\"RR of typhoid\", theta=150, phi=5, lphi=100, col=\"gray80\", main=\"A\", cex.lab=1.1, cex.axis=1.1)\nplot(typ.pred.temp, xlab=\"Temperature (°C) [given lag 2]\", \"slices\", lag=c(2), col=\"red2\", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab=\"RR of typhoid\", cex.lab=1.1, cex.axis=1.1,main=\"B\")\nplot(typ.pred.temp, xlab=\"Temperature (°C) [given lag 5]\", \"slices\", lag=c(5), col=\"red2\", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab=\"RR of typhoid\", cex.lab=1.1, cex.axis=1.1,main=\"C\")\nplot(typ.pred.temp, xlab=\"Lag (month) [given 19 °C]\", \"slices\", var=c(19), col=\"red2\", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab=\"RR of typhoid\", cex.lab=1.1, cex.axis=1.1,main=\"D\")\nplot(typ.pred.temp, xlab=\"Lag (month) [given 25 °C]\", \"slices\", var=c(25), col=\"red2\", ci.arg=list(col=terrain.colors(70, alpha = 1)), ci.level=0.95,ci='b', lwd=4.5, ylab=\"RR of typhoid\", cex.lab=1.1, cex.axis=1.1,main=\"E\")\n```\n\n##### Plots of validation checks (Supplementary Figure S4)\n```{r validationCheck, results=\"hide\", message=FALSE, warning=FALSE, fig.width=12, fig.height=8, fig.align='center'}\npar(mfrow=c(3,4))\nplot(mo.dlnmN$date, residuals(nts.model,type=\"deviance\"), pch=19, cex=0.8, col=grey(0.4),main=\"A\", ylab=\"Residuals\",xlab=\"\",cex.lab=1.2,cex.axis=1.2) \nabline(h=0,lty=2,lwd=3)\npacf(residuals(nts.model,type=\"deviance\"),na.action=na.omit,main=\"B\",xlim=c(0,8),xlab=\"\", cex.lab=1.2,cex.axis=1.2)\nacf(residuals(nts.model,type=\"deviance\"),na.action=na.omit,main=\"C\",xlim=c(0,8),xlab=\"\", cex.lab=1.2,cex.axis=1.2)\nplot(matrix(mo.dlnmN$incid_seaX),matrix(predict(nts.model, type=\"response\")), col=c(\"orange2\",\"gray2\"),xlab=\"Predicted NTS incidence\", ylab=\"Observed NTS incidence\",pch=19,cex=0.8,cex.lab=1.2,cex.axis=1.2)\nlegend(\"topleft\", legend=c(\"observed\", \"predicted\"), col=c(\"grey30\", \"orange2\"), cex=0.8, pch=19)\n\nplot(mo.dlnmT$date, residuals(typ.modelR,type=\"deviance\"), pch=19, cex=0.8, col=grey(0.6),main=\"E\", ylab=\"Residuals\",xlab=\"\",cex.lab=1.2,cex.axis=1.2)\nabline(h=0,lty=2,lwd=3)\npacf(residuals(typ.modelR,type=\"deviance\"),na.action=na.omit,main=\"F\",xlim=c(0,8),xlab=\"\",cex.lab=1.2, cex.axis=1.2)\nacf(residuals(typ.modelR,type=\"deviance\"),na.action=na.omit,main=\"G\",xlim=c(0,8),xlab=\"\",cex.lab=1.2, cex.axis=1.2)\nplot(matrix(mo.dlnmT$incid_seaX),matrix(predict(typ.modelR, type=\"response\")), col=c(\"red2\",\"gray2\"),xlab=\"Predicted typhoid incidence\", ylab=\"Observed typhoid incidence\",pch=19,cex=0.8,cex.lab=1.2,cex.axis=1.2)\nlegend(\"topleft\", legend=c(\"observed\", \"predicted\"), col=c(\"grey30\", \"red2\"), cex=0.8, pch=19)\n\nplot(mo.dlnmT$date, residuals(typ.modelT,type=\"deviance\"), pch=19, cex=0.8, col=grey(0.6),main=\"I\", ylab=\"Residuals\", xlab=\"Year\",cex.lab=1.2,cex.axis=1.2) \nabline(h=0,lty=2,lwd=3)\npacf(residuals(typ.modelT,type=\"deviance\"),na.action=na.omit,main=\"J\",xlim=c(0,8),xlab=\"Lag (month)\",cex.lab=1.2, cex.axis=1.2)\nacf(residuals(typ.modelT,type=\"deviance\"),na.action=na.omit,main=\"K\",xlim=c(0,8),xlab=\"Lag (month)\",cex.lab=1.2, cex.axis=1.2)\nplot(matrix(mo.dlnmT$incid_seaX),matrix(predict(typ.modelT, type=\"response\")), col=c(\"red2\",\"gray2\"),xlab=\"Predicted typhoid incidence\", ylab=\"Observed typhoid incidence\",pch=19,cex=0.8,cex.lab=1.2,cex.axis=1.2)\nlegend(\"topleft\", legend=c(\"observed\", \"predicted\"), col=c(\"grey30\", \"red2\"), cex=0.8, pch=19)\n```\n\n##### Plots of predictions due to rainfall/temperature (Table 1)\n```{r predictEstimates, fig.align='center', message=FALSE, warning=FALSE}\nRRTable <- data.frame(rbind(nts.pred.rain$matRRfit[\"9\",], nts.pred.rain$matRRlow[\"9\",], nts.pred.rain$matRRhigh[\"9\",],\n                 nts.pred.rain$matRRfit[\"13\",],nts.pred.rain$matRRlow[\"13\",],nts.pred.rain$matRRhigh[\"13\",],\n                 nts.pred.temp$matRRfit[\"19\",],nts.pred.temp$matRRlow[\"19\",],nts.pred.temp$matRRhigh[\"19\",],\n                 nts.pred.temp$matRRfit[\"29\",],nts.pred.temp$matRRlow[\"29\",],nts.pred.temp$matRRhigh[\"29\",],\n                 typ.pred.rain$matRRfit[\"9\",],typ.pred.rain$matRRlow[\"9\",],typ.pred.rain$matRRhigh[\"9\",],\n                 typ.pred.rain$matRRfit[\"16\",],typ.pred.rain$matRRlow[\"16\",],typ.pred.rain$matRRhigh[\"16\",],\n                 typ.pred.temp$matRRfit[\"19\",],typ.pred.temp$matRRlow[\"19\",],typ.pred.temp$matRRhigh[\"19\",],\n                 typ.pred.temp$matRRfit[\"25\",],typ.pred.temp$matRRlow[\"25\",],typ.pred.temp$matRRhigh[\"25\",]\n                 ))\nkable(RRTable)\n```\n\n\n##### Vary degrees of freedom for sensitivity analyses of NTS/typhoid predictions\n```{r sensitivityDF, results=\"hide\", message=FALSE, warning=FALSE}\nnts.cb.rain <- list()\nnts.cb.temp <- list()\ntyp.cb.rain <- list()\ntyp.cb.temp <- list()\nsort(mo.dlnmN$rainfall_obs, decreasing=FALSE)\nsort(mo.dlnmN$temperature_obs, decreasing=FALSE)\nsort(mo.dlnmT$rainfall_obs, decreasing=FALSE)\nsort(mo.dlnmT$temperature_obs, decreasing=FALSE)\nl=1\nfor(k in 3:5){\n  for(j in 3:5){\n    for(i in 3:5){\nnts.lagknots <- logknots(8, fun=\"ns\", df=i)\nnts.varknots.r=equalknots(mo.dlnmN$rainfall_obs, fun=\"ns\", df=j)\nnts.varknots.t=equalknots(mo.dlnmN$temperature_obs, fun=\"ns\", df=k)\nnts.cb.rain[[l]] <- crossbasis(mo.dlnmN$rainfall_obs, lag=8, argvar=list(fun=\"ns\", knots=nts.varknots.r), arglag=list(knots=nts.lagknots))\nnts.cb.temp[[l]] <- crossbasis(mo.dlnmN$temperature_obs, lag=8, argvar=list(fun=\"ns\", knots=nts.varknots.t), arglag=list(knots=nts.lagknots))\n\ntyp.lagknots <- logknots(8, fun=\"ns\", df=i)\ntyp.varknots.r=equalknots(mo.dlnmT$rainfall_obs, fun=\"ns\", df=j)\ntyp.varknots.t=equalknots(mo.dlnmT$temperature_obs, fun=\"ns\", df=k)\ntyp.cb.rain[[l]] <- crossbasis(mo.dlnmT$rainfall_obs, lag=8, argvar=list(fun=\"ns\", knots=typ.varknots.r), arglag=list(knots=typ.lagknots))\ntyp.cb.temp[[l]] <- crossbasis(mo.dlnmT$temperature_obs, lag =8, argvar = list(fun=\"ns\", knots=typ.varknots.t), arglag=list(knots=typ.lagknots))\n  \n  l=l+1  \n  }\n  }\n}\n```\n\n##### Formulate alternative sensitivity models and plot predictions of NTS (Supplementay Figure S5)\n```{r sensitivityNTS, results=\"hide\", message=FALSE, warning=FALSE, fig.width=12, fig.height=5, fig.align='center'}\nnts.cb.rain.s1 <- nts.cb.rain[[2]]; nts.cb.temp.s1 <- nts.cb.temp[[2]]\nnts.cb.rain.s2 <- nts.cb.rain[[3]]; nts.cb.temp.s2 <- nts.cb.temp[[3]]\nnts.cb.rain.s3 <- nts.cb.rain[[4]]; nts.cb.temp.s3 <- nts.cb.temp[[4]]\nnts.cb.rain.s4 <- nts.cb.rain[[7]]; nts.cb.temp.s4 <- nts.cb.temp[[7]]\nnts.cb.rain.s5 <- nts.cb.rain[[10]]; nts.cb.temp.s5 <- nts.cb.temp[[10]]\nnts.cb.rain.s6 <- nts.cb.rain[[19]]; nts.cb.temp.s6 <- nts.cb.temp[[19]]\n\nnts.model.s1 <- glm(incid_seaX~nts.cb.rain.s1 + nts.cb.temp.s1 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)\nnts.model.s2 <- glm(incid_seaX~nts.cb.rain.s2 + nts.cb.temp.s2 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)\nnts.model.s3 <- glm(incid_seaX~nts.cb.rain.s3 + nts.cb.temp.s3 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)\nnts.model.s4 <- glm(incid_seaX~nts.cb.rain.s4 + nts.cb.temp.s4 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)\nnts.model.s5 <- glm(incid_seaX~nts.cb.rain.s5 + nts.cb.temp.s5 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)\nnts.model.s6 <- glm(incid_seaX~nts.cb.rain.s6 + nts.cb.temp.s6 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmN)\n\nnts.model.s1 <- update(nts.model.s1,.~.+Lag(residuals(nts.model.s1,type=\"deviance\"),1)) #add residuals at lag 1\nnts.model.s2 <- update(nts.model.s2,.~.+Lag(residuals(nts.model.s2,type=\"deviance\"),1)) #to correct for partial\nnts.model.s3 <- update(nts.model.s3,.~.+Lag(residuals(nts.model.s3,type=\"deviance\"),1)) #autocorrelation\nnts.model.s4 <- update(nts.model.s4,.~.+Lag(residuals(nts.model.s4,type=\"deviance\"),1)) \nnts.model.s5 <- update(nts.model.s5,.~.+Lag(residuals(nts.model.s5,type=\"deviance\"),1)) \nnts.model.s6 <- update(nts.model.s6,.~.+Lag(residuals(nts.model.s6,type=\"deviance\"),1)) \n\nnts.pred.rain.s1 <- crosspred(nts.cb.rain.s1, nts.model.s1, cen=0, by=0.2)\nnts.pred.rain.s2 <- crosspred(nts.cb.rain.s2, nts.model.s2, cen=0, by=0.2)\nnts.pred.rain.s3 <- crosspred(nts.cb.rain.s3, nts.model.s3, cen=0, by=0.2)\nnts.pred.rain.s4 <- crosspred(nts.cb.rain.s4, nts.model.s4, cen=0, by=0.2)\nnts.pred.rain.s5 <- crosspred(nts.cb.rain.s5, nts.model.s5, cen=0, by=0.2)\nnts.pred.rain.s6 <- crosspred(nts.cb.rain.s6, nts.model.s6, cen=0, by=0.2)\n\nnts.pred.temp.s1 <- crosspred(nts.cb.temp.s1, nts.model.s1, cen=23, by=0.2)\nnts.pred.temp.s2 <- crosspred(nts.cb.temp.s2, nts.model.s2, cen=23, by=0.2)\nnts.pred.temp.s3 <- crosspred(nts.cb.temp.s3, nts.model.s3, cen=23, by=0.2)\nnts.pred.temp.s4 <- crosspred(nts.cb.temp.s4, nts.model.s4, cen=23, by=0.2)\nnts.pred.temp.s5 <- crosspred(nts.cb.temp.s5, nts.model.s5, cen=23, by=0.2)\nnts.pred.temp.s6 <- crosspred(nts.cb.temp.s6, nts.model.s6, cen=23, by=0.2)\n\npar(mfrow=c(2,6))\nplot(nts.pred.rain.s1,\"slices\",var=c(9),col=\"orange2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"A\")\nplot(nts.pred.rain.s2,\"slices\",var=c(9),col=\"orange2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"C\")\nplot(nts.pred.rain.s3,\"slices\",var=c(9),col=\"orange2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"E\")\nplot(nts.pred.rain.s4,\"slices\",var=c(9),col=\"orange2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"G\")\nplot(nts.pred.rain.s5,\"slices\",var=c(9),col=\"orange2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"I\")\nplot(nts.pred.rain.s6,\"slices\",var=c(9),col=\"orange2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"K\")\n\nplot(nts.pred.temp.s1,\"slices\",var=c(19),col=\"orange2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"B\")\nplot(nts.pred.temp.s2,\"slices\",var=c(19),col=\"orange2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"D\")\nplot(nts.pred.temp.s3,\"slices\",var=c(19),col=\"orange2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"F\")\nplot(nts.pred.temp.s4,\"slices\",var=c(19),col=\"orange2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"H\")\nplot(nts.pred.temp.s5,\"slices\",var=c(19),col=\"orange2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"J\")\nplot(nts.pred.temp.s6,\"slices\",var=c(19),col=\"orange2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of NTS\",cex.lab=1.1,cex.axis=1.1,main=\"L\")\n```\n\n##### Formulate alternative sensitivity models and plot predictions of Typhoid (Supplementay Figure S6)\n```{r sensitivityTyp, results=\"hide\", message=FALSE, warning=FALSE, fig.width=12, fig.height = 5, fig.align='center'}\ntyp.cb.rain.s1 <- typ.cb.rain[[2]]; typ.cb.temp.s1 <- typ.cb.temp[[2]]\ntyp.cb.rain.s2 <- typ.cb.rain[[3]]; typ.cb.temp.s2 <- typ.cb.temp[[3]]\ntyp.cb.rain.s3 <- typ.cb.rain[[4]]; typ.cb.temp.s3 <- typ.cb.temp[[4]]\ntyp.cb.rain.s4 <- typ.cb.rain[[7]]; typ.cb.temp.s4 <- typ.cb.temp[[7]]\ntyp.cb.rain.s5 <- typ.cb.rain[[10]]; typ.cb.temp.s5 <- typ.cb.temp[[10]]\ntyp.cb.rain.s6 <- typ.cb.rain[[19]]; typ.cb.temp.s6 <- typ.cb.temp[[19]]\n\ntyp.modelR.s1 <- glm(incid_seaX~typ.cb.rain.s1 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelR.s2 <- glm(incid_seaX~typ.cb.rain.s2 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelR.s3 <- glm(incid_seaX~typ.cb.rain.s3 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelR.s4 <- glm(incid_seaX~typ.cb.rain.s4 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelR.s5 <- glm(incid_seaX~typ.cb.rain.s5 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelR.s6 <- glm(incid_seaX~typ.cb.rain.s6 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelT.s1 <- glm(incid_seaX~typ.cb.rain.s1 + typ.cb.temp.s1 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelT.s2 <- glm(incid_seaX~typ.cb.rain.s2 + typ.cb.temp.s2 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelT.s3 <- glm(incid_seaX~typ.cb.rain.s3 + typ.cb.temp.s3 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelT.s4 <- glm(incid_seaX~typ.cb.rain.s4 + typ.cb.temp.s4 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelT.s5 <- glm(incid_seaX~typ.cb.rain.s5 + typ.cb.temp.s5 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\ntyp.modelT.s6 <- glm(incid_seaX~typ.cb.rain.s6 + typ.cb.temp.s6 + year, family=quasipoisson(), na.action=na.exclude, mo.dlnmT)\n\t\ntyp.modelR.s1 <- update(typ.modelR.s1,.~.+Lag(residuals(typ.modelR.s1,type=\"deviance\"),1))\ntyp.modelR.s1 <- update(typ.modelR.s1,.~.+Lag(residuals(typ.modelR.s1,type=\"deviance\"),2))\ntyp.modelR.s1 <- update(typ.modelR.s1,.~.+Lag(residuals(typ.modelR.s1,type=\"deviance\"),3))\ntyp.modelR.s1 <- update(typ.modelR.s1,.~.+Lag(residuals(typ.modelR.s1,type=\"deviance\"),4))\ntyp.modelR.s2 <- update(typ.modelR.s2,.~.+Lag(residuals(typ.modelR.s2,type=\"deviance\"),1)) \ntyp.modelR.s2 <- update(typ.modelR.s2,.~.+Lag(residuals(typ.modelR.s2,type=\"deviance\"),2))\ntyp.modelR.s2 <- update(typ.modelR.s2,.~.+Lag(residuals(typ.modelR.s2,type=\"deviance\"),3))\ntyp.modelR.s5 <- update(typ.modelR.s5,.~.+Lag(residuals(typ.modelR.s5,type=\"deviance\"),1)) \ntyp.modelR.s5 <- update(typ.modelR.s5,.~.+Lag(residuals(typ.modelR.s5,type=\"deviance\"),2))\ntyp.modelR.s5 <- update(typ.modelR.s5,.~.+Lag(residuals(typ.modelR.s5,type=\"deviance\"),3))\ntyp.modelR.s6 <- update(typ.modelR.s6,.~.+Lag(residuals(typ.modelR.s6,type=\"deviance\"),1)) \ntyp.modelR.s6 <- update(typ.modelR.s6,.~.+Lag(residuals(typ.modelR.s6,type=\"deviance\"),2)) \ntyp.modelR.s6 <- update(typ.modelR.s6,.~.+Lag(residuals(typ.modelR.s6,type=\"deviance\"),3)) \n\ntyp.modelT.s1 <- update(typ.modelT.s1,.~.+Lag(residuals(typ.modelT.s1,type=\"deviance\"),1))\ntyp.modelT.s1 <- update(typ.modelT.s1,.~.+Lag(residuals(typ.modelT.s1,type=\"deviance\"),3))\ntyp.modelT.s2 <- update(typ.modelT.s2,.~.+Lag(residuals(typ.modelT.s2,type=\"deviance\"),1)) \ntyp.modelT.s3 <- update(typ.modelT.s3,.~.+Lag(residuals(typ.modelT.s3,type=\"deviance\"),1)) \ntyp.modelT.s4 <- update(typ.modelT.s4,.~.+Lag(residuals(typ.modelT.s4,type=\"deviance\"),1)) \ntyp.modelT.s4 <- update(typ.modelT.s4,.~.+Lag(residuals(typ.modelT.s4,type=\"deviance\"),2)) \ntyp.modelT.s5 <- update(typ.modelT.s5,.~.+Lag(residuals(typ.modelT.s5,type=\"deviance\"),1)) \ntyp.modelT.s5 <- update(typ.modelT.s5,.~.+Lag(residuals(typ.modelT.s5,type=\"deviance\"),4))\ntyp.modelT.s5 <- update(typ.modelT.s5,.~.+Lag(residuals(typ.modelT.s5,type=\"deviance\"),3))\ntyp.modelT.s6 <- update(typ.modelT.s6,.~.+Lag(residuals(typ.modelT.s6,type=\"deviance\"),1)) \n\ntyp.pred.rain.s1 <- crosspred(typ.cb.rain.s1, typ.modelR.s1, cen=0, by=0.2)\ntyp.pred.rain.s2 <- crosspred(typ.cb.rain.s2, typ.modelR.s2, cen=0, by=0.2)\ntyp.pred.rain.s3 <- crosspred(typ.cb.rain.s3, typ.modelR.s3, cen=0, by=0.2)\ntyp.pred.rain.s4 <- crosspred(typ.cb.rain.s4, typ.modelR.s4, cen=0, by=0.2)\ntyp.pred.rain.s5 <- crosspred(typ.cb.rain.s5, typ.modelR.s5, cen=0, by=0.2)\ntyp.pred.rain.s6 <- crosspred(typ.cb.rain.s6, typ.modelR.s6, cen=0, by=0.2)\n\ntyp.pred.temp.s1 <- crosspred(typ.cb.temp.s1, typ.modelT.s1, cen=23, by=0.2)\ntyp.pred.temp.s2 <- crosspred(typ.cb.temp.s2, typ.modelT.s2, cen=23, by=0.2)\ntyp.pred.temp.s3 <- crosspred(typ.cb.temp.s3, typ.modelT.s3, cen=23, by=0.2)\ntyp.pred.temp.s4 <- crosspred(typ.cb.temp.s4, typ.modelT.s4, cen=23, by=0.2)\ntyp.pred.temp.s5 <- crosspred(typ.cb.temp.s5, typ.modelT.s5, cen=23, by=0.2)\ntyp.pred.temp.s6 <- crosspred(typ.cb.temp.s6, typ.modelT.s6, cen=23, by=0.2)\n\t\npar(mfrow=c(2,6))\nplot(typ.pred.rain.s1,\"slices\",var=c(9),col=\"red2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"A\")\nplot(typ.pred.rain.s2,\"slices\",var=c(9),col=\"red2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"C\")\nplot(typ.pred.rain.s3,\"slices\",var=c(9),col=\"red2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"E\")\nplot(typ.pred.rain.s4,\"slices\",var=c(9),col=\"red2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"G\")\nplot(typ.pred.rain.s5,\"slices\",var=c(9),col=\"red2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"I\")\nplot(typ.pred.rain.s6,\"slices\",var=c(9),col=\"red2\",ci.arg=list(col=topo.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 9 mm)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"K\")\n\t\nplot(typ.pred.temp.s1,\"slices\",var=c(19),col=\"red2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR oftyphoid\",cex.lab=1.1,cex.axis=1.1,main=\"B\")\nplot(typ.pred.temp.s2,\"slices\",var=c(19),col=\"red2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"D\")\nplot(typ.pred.temp.s3,\"slices\",var=c(19),col=\"red2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"F\")\nplot(typ.pred.temp.s4,\"slices\",var=c(19),col=\"red2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"H\")\nplot(typ.pred.temp.s5,\"slices\",var=c(19),col=\"red2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"J\")\nplot(typ.pred.temp.s6,\"slices\",var=c(19),col=\"red2\",ci.arg=list(col=terrain.colors(70,alpha=1)),ci.level=0.95,ci='b',lwd=4.5,xlab=\"Month-lag (given 19 °C)\",ylab=\"RR of typhoid\",cex.lab=1.1,cex.axis=1.1,main=\"L\")\n```\n\n",
    "created" : 1551648632824.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3634918621",
    "id" : "ED24F659",
    "lastKnownWriteTime" : 1551648643,
    "last_content_update" : 1551648643077,
    "path" : "~/Rproject/Time.Series/report/dlnm.salmonella.Rmd",
    "project_path" : "report/dlnm.salmonella.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}